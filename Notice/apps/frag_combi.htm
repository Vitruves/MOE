<!DOCTYPE html>
<html>

<!--
!!    MOE On-Line Manuals
!!    COPYRIGHT (C) CHEMICAL COMPUTING GROUP ULC.  ALL RIGHTS RESERVED.
!!-->
<head>
  <meta http-equiv="x-ua-compatible" content="IE=9" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../include/manstyle.css" />
  <link rel="icon" type="image/png" href="../images/ccgicon.png" />
  <link rel="shortcut icon" type="image/png" href="../images/ccgicon.png" />
  <title>Combinatorial Builder</title>
  <meta name="keywords" content="panel: Combinatorial Builder" />
  <meta name="keywords" content="keywords: batch file" />
</head>
<body>
<div class="center-page">
  <!-- START MOE_HEADER -->
  <div class="MOE_HEADER">
    <a href="../index.htm"><img src="../images/ccglogo.png" /></a>
    <a href="../index.htm"><div class="moeversion"></div></a>
    Combinatorial Builder
  </div>
<!-- END MOE_HEADER -->
<div class="content">
  <ul>
    <li><a href="#Method">Methodology</a></li>
    <li><a href="#TorsDriver">Torsion Driver</a></li>
    <li><a href="#RunCombi">Running the Combinatorial Builder</a></li>
    <li><a href="#Example" class="example">Examples</a></li>
    <ul>
    <li><a class="example" href="#simpleAddition">Simple Addition</a></li>
    <li><a class="example" href="#variableRotor">Variable Free Rotor</a></li>
    <li><a class="example" href="#combiBuilding">Combinatorial Building</a></li>
    </ul>
    <li><a href="#Ref">References</a></li>
    <li><a href="#seeAlso">See Also</a></li>
  </ul>

<p>The Combinatorial Builder enumerates a virtual library of all possible
  products that are combinatorially generated from a core scaffold and a set of
  monodentate R-group databases. The user indicates the atom(s) to be used as
  <i>attachment points</i> and associates an R-group library with each (or
  accepts the default). For substituents with multiple connections, <a href=
  "../apps/scaffold.htm">Scaffold Replacement</a> or <a href=
  "../apps/combitools.htm">Combinatorial Library</a> should be used. If a
  receptor is available, Forcefield Refinement can be used to generate bound
  poses along with various docking scores.
  <!-- ============================= METHODOLOGY -=========================== --></p>
<a id="Method"></a>
<h1>Methodology</h1>

<p>The Combinatorial Builder application performs a series of operations on
  behalf of the user, as indicated in the following flowchart. Each will be
  described in detail in following sections.</p>

<img src="frag_combi/combiflow.jpg" alt=
  "Combinatorial Builder Flowchart" class="center" />

<p>The starting point for the Combinatorial Builder is a ligand that will be
  used as the scaffold. If a receptor is present, the scaffold is assumed to be
  in the cleft and pocket atoms are used to constrain molecular construction.
  In such cases, Forcefield Refinement and Scoring can be used to evaluate
  protein/ligand poses.</p>

<h2>Generate Rotamers</h2>

<p>Attachment points define the sites where R-groups from the user-specified
  (or default) libraries are connected to the scaffold. Thus, they define an
  axis about which low-energy, rigid-body rotamers of each R-group can be
  generated. The sets of rotamers for each axis are used to construct output
  molecules. A multi-step process is applied to each R-group for each axis:</p>
  <ol start="1">
    <li>If present, a SMARTS filter is used to eliminate undesirable chemistry
    (such as forming a peroxide). This can be tailored for individual R-groups
    and is stored in the R-group library.</li>
    <li>The Torsion Driver (described below) is used to generate all possible
    rotamers. Clashes with the scaffold and the receptor (if present) are
    removed via a soft clash energy filter.</li>
    <li>Duplicate and/or high-energy structures are removed and the remaining
    rotamers are sorted by increasing energy.</li>
  </ol>
<a id="TorsDriver"></a>
<h2>Torsion Driver</h2>

<p>Many modeling applications require finding the minimum-energy or the set
  of low-energy rotamers about a bond:</p>

<img src="frag_combi/bondrot3.png" alt="Bond Rotation Example" class="center" />

<p>The <a href="../moe/gui/mainwin.htm#FooterEditing">Profile</a> button in
  the MOE footer is such an example, using the current forcefield to provide a
  graphical tool to review and set the torsion angle of the selected bond.</p>

<p>The Torsion Driver assumes that a library of rigid-body R-groups (which
  might be large) will be oriented about an axis defined by a rotatable bond.
  As with <a href="../apps/ph4_search.htm">pharmacophore search</a>, R-group
  libraries should contain one or more conformations of each structure as
  appropriate. The possible positions of R-group atoms can be visualized as a
  cylindrical grid, with each point specified by a particular distance along
  the bond axis and distance perpendicular to the axis. Interaction energies
  with the scaffold (and the receptor if present) can be calculated at each
  point using a soft clash 800R3 potential:</p>

<img src="frag_combi/math_800R3potential.png" alt=
  "Soft Clash Potential" class="center" />

<p>where atom <i>i</i> is an sp3 carbon probe and atom <i>j</i> is an atom of
  the scaffold or receptor. &epsilon;<sub><i>i</i></sub> and
  &epsilon;<sub><i>j</i></sub> are the van der Waals well-depths (in kcal/mol),
  <i>r<sub>ij</sub></i> is the point-atom distance and R<sub><i>i</i></sub> and
  R<sub><i>j</i></sub> are the van der Waals radii. The parameters are modified
  OPLS-AA van der Waals parameters tuned to reproduce the free energy of
  solvation of a collection of small molecules. A clash energy cutoff can be
  used to exclude points with unfavorable interactions with the scaffold (or
  protein, if present). This yields the set of positions where a R-group atom
  is sterically allowed:</p>

<img src="frag_combi/bonddots4.jpg" alt="Bond Axis Example" class="center" />

<p>In this example, you can see the grid of valid atom locations (in green)
  along with the regions excluded by contact with the receptor or scaffold.
  Receptor excluded volumes are located at the top and bottom (white regions)
  and the scaffold excluded volume is indicated at the right. The atoms of a
  small portion of the receptor are shown as space-filled spheres, which lie in
  an excluded region.</p>

<p>The clash grid can be used to reduce the number of rotamers that must be
  examined when adding an R-group to the scaffold. Each R-group (passing any
  SMARTS filter that might be present) is joined to the scaffold in a standard
  orientation and the position of the R-group atoms relative to the grid is
  determined. The location of each atom is used to define a circular set of
  points at a common distance and radius about the bond axis:</p>

<img src="frag_combi/bondarcs3.jpg" alt="Atom Allowed Example" class="center" />

<p>The points in blue define the permitted positions for each atom (several
  are superimposed). The indicated gaps for the meta hydrogen atoms result from
  steric clash with the receptor. The specific geometry of the pyridyl group
  does not clash with the scaffold, so there are no restrictions on the ortho
  hydrogens. The radial resolution of the clash grid used to generate these
  points was 5 degrees.</p>

<a id="freeRotor"></a>
<p>For calculations involving free rotors (such as <b>-CH<sub>3</sub></b> or
  <b>-NH<sub>2</sub></b>), the Combinatorial Builder (by default) assumes the
  hydrogen positions are not well-defined. In such cases (below left), an
  initial scan is done:</p>
  <ol start="1">
    <li>Substitute a methyl for the selected hydrogen.</li>
    <li>Generate the unique, low-energy rotamers for the bond connecting the
    terminal heavy atom to the scaffold (in this case
    <b>-CH<sub>2</sub>CH<sub>3</sub></b>).</li>
    <li>Record the position(s) of the carbon atom of the methyl group.</li>
    <li>Restore the original molecule.</li>
  </ol>
  <table class="noborder">
    <tr>
      <td><img src="frag_combi/rotpix1b.png" alt="Original Selection" /></td>
      <td><img src="frag_combi/rotpix2b.png" alt=
      "Low-Energy Alternatives" /></td>
    </tr>
    <tr>
      <td class="center">original selection</td>
      <td class="center">low-energy alternatives</td>
    </tr>
  </table>

<p>The position(s) of the methyl carbon atom (above right) are used as
  attachment point locations and the rotamers for each generated axis are
  combined. This results in better sampling of the available conformation space
  of the free rotor. This process is not used if more than one hydrogen on the
  heavy atom is selected. Fixed atoms are considered invariant.</p>

<p>The circular set of points associated with each R-group atom can be
  expressed as bit strings, where 1 is an allowed location and 0 is a forbidden
  one. These can be compared if they are transformed into a standard
  orientation relative to the bond axis. This is done via circular shifts,
  rotating each set of bits by an offset set to the negative of the atom's
  initial torsion angle. In the pyridyl example above, the offsets would be
  0<sup style="font-size: 70%">o</sup> and 180<sup style=
  "font-size: 70%">o</sup>, but the specific geometry of individual R-groups
  determines the offset for each atom. Once transformed, a Boolean AND of the
  1's and 0's of the transformed sets yields the torsion angle subset
  that must be checked.</p>

<p>A toy example is provided below, using a low-resolution grid with a radial
  resolution of 30 degrees (12 points per circular set). The R-group is assumed
  to have an arbitrary 3D geometry, with different offsets for each atom. The
  bits for four of the atoms are shown below left:</p>

<img src="frag_combi/andOp2.jpg" alt="Angle Subset Example" class="center" />

<p>The bits in <font color="red">red</font> are those that must be circularly
  shifted to transform them into standard orientation. Once this is done, the
  bits on the right can be ANDed together to yield the torsion angle subset.
  These are indicated in <font color="#3090C7">blue</font>, corresponding to
  30<sup style="font-size: 70%">o</sup>, 210<sup style="font-size: 70%">o</sup>
  and 330<sup style="font-size: 70%">o</sup> angles. This can greatly reduce
  the number of forcefield calculations required to generate rotamers,
  particularly for cases involving tight receptor pockets. If multiple
  attachment points are generated, the Boolean calculation is performed for
  each and the results are merged.</p>

<p>The rotamer energy must be calculated for each value in the torsional
  angle subset, given by</p>

<p class="center"><b>E<sub>rot</sub></b> = <b>E<sub>rp</sub></b> +
  <b>(E<sub>rs</sub></b> - min <b>E<sub>rs</sub></b>)</p>

<p>where <b>E<sub>rp</sub></b> is the R-group/protein energy and
  <b>E<sub>rs</sub></b> is the R-group/scaffold energy. <b>E<sub>rp</sub></b>
  is calculated from the van der Waals and charge terms of the current
  forcefield, while <b>E<sub>rs</sub></b> uses these terms along with the
  torsional energy of the R-group/scaffold bond. As the system is a rigid
  rotor, the other terms are constant and can be ignored. The second term is
  always positive and is a conformation energy penalty for higher-energy
  rotamers. Duplicates, defined as higher-energy rotamers within the specified
  torsional angle window, and rotamers failing the maximum energy threshold are
  removed. The remaining rotamers (if any) are returned (sorted by increasing
  <b>E<sub>rot</sub></b>).</p>

<h2>Construct Molecule</h2>

<p>The information provided by the Torsion Driver for each bond is used to
  construct candidate molecules. This is a two-step process:</p>
  <ol start="1">
    <li>For each bond, all rotamers whose <b>E<sub>rp</sub></b> exceeds the
    Protein-Ligand Clash Energy parameter and/or all rotamers whose
    <b>E<sub>rs</sub></b> exceeds the Intra-Ligand Clash Energy parameter are
    discarded.</li>
    <li>If only one bond is present, the axis rotamer energy is used as the
    candidate molecule energy. However, if more than one bond is present, the
    conformation energy penalty for R-group interactions must be determined as
    well. The candidate molecule energy becomes:

<p class="center"><b>E<sub>mol</sub></b> = <span style=
      "font-size: 130%">&Sigma;</span> <b><sub>bond</sub> E<sub>bond</sub></b>
      + <span style="font-size: 130%">&Sigma;</span><b><sub>i&lt;j</sub></b>
      (<b>E<sub>ij</sub></b> - min <b>E<sub>ij</sub></b>)</p>where
      <b>E<sub>bond</sub></b> is the rotamer energy returned by the Torsion
      Driver and <b>E<sub>ij</sub></b> is the interaction energy between
      R-groups <i>i</i> and <i>j</i>. Candidate molecules exceeding the maximum
      energy threshold are discarded.
    </li>
  </ol>

<h2>Filters</h2>

<p>Constructed molecules can be filtered in three ways. First, a <a href=
  "../quasar/fcnref/descrfcn.htm#DescriptorExprSyntax">Descriptor Filter</a>
  can be specified and the calculated MOE <a href=
  "../quasar/descr.htm">Descriptors</a> must satisfy the range/Boolean values
  specified. Second, a <a href="../quasar/modcomp.htm#Composer">Model file</a>
  can be provided, and each new molecule must satisfy the specified criterion.
  Finally, a pharmacophore query can be provided, which the absolute positions
  of each new molecule must satisfy. Structures failing any of these filters
  are discarded. For the molecules that pass the filters, all calculated
  properties are written to the output database.</p>

<h2>Synthetic Score</h2>

<p>A <a href="../moe/fcnref/rsynthfcn.htm">Synthetic Feasibility Score</a> is
  calculated for every new molecule that has passed the specified filters. This
  is a score in the range of 0 to 1 with 1 meaning fully synthesizable and 0
  meaning not feasible. This can be used as a term in the Descriptor Filter via
  the <tt>rsynth</tt> descriptor.</p>

<h2>Refine + Score</h2>

<p>If a receptor is present, <a href="docking.htm#Example_PostDocking">Forcefield
  Refinement</a> can be used to relax each new molecule in the pocket.
  Sidechains can be treated flexibly (with or without a tether), but backbone
  atoms are always held fixed. This generates an energy score using the
  <a href="../moe/pot.htm#Equation">Generalized Born solvation model
  (GB/VI)</a> [Labute&nbsp;2008]. This value, along with the protein
  coordinates if the sidechains were not fixed, is written to the output
  database. Molecules can be scored using one of the methods in MOE's
  <a href="docking.htm#Computational_Background">Docking</a> application. If the
  <tt>London&nbsp;dG</tt> score is calculated, the ligand efficiency (estimated
  pKi divided by the number of heavy atoms) is also written to the output
  database.</p>

<p>If no Receptor is present, tethered minimization (using the current
  forcefield) can be used to generate relaxed structures with as little global
  change in ligand alignment or orientation as possible. A variable, parabolic
  force constant is applied to each heavy atom of the scaffold. This allows the
  portion of the scaffold in each new structure proximate to the R-groups to
  relax freely while preserving the overall geometry.</p>

<p>If a pharmacophore query filter is used, minimization or refinement will
  use forcefield restraints between the features in the query and the
  pharmacophore annotations in the molecule. Such restraints will only be
  applied if the pharmacophore query uses the <a href="ph4_annot.htm">Unified
  Annotation Scheme</a>.
  <!-- ============================ RUNNING ================================ !--></p>
<a id="RunCombi"></a>
<h1>Running the Combinatorial Builder</h1>

<p>To start the Combinatorial Builder, load a ligand (and associated receptor
  structure if available) into the main MOE window and select <span class=
  "menu">MOE | Compute | Fragments | Combinatorial Builder</span>.</p>

<img src="frag_combi/fcpanel.png" alt="Combinatorial Builder Panel" class="center" />
  <table class="noborder">
    <tr>
      <td><b>Ligand</b></td>
      <td>The atoms that define the ligand used by the
      Combinatorial Builder. This will be the scaffold to which all R-groups
      will be connected. Press the <b>?</b> button to the right to briefly
      highlight (in the MOE window) the specified atoms.</td>
    </tr>
    <tr>
      <td><b>Receptor</b></td>
      <td>The atoms that define the protein used by the
      Combinatorial Builder. Press the <b>?</b> button to the right to briefly
      highlight (in the MOE window) the specified atoms. This atom collection
      can also be manually specified by selecting objects in the Sequence
      Editor and choosing the appropriate atom set.</td>
    </tr>
    <tr>
      <td><b>Operation</b></td>
      <td>Specifies the method used to generate structures, using
      Scaffold Replacement, MedChem Transformations, BREED or Combinatorial
      Builder. Choose <b>Combinatorial Builder</b> to run the Combinatorial
      Builder application. Select atoms or edit the atom names to define
      attachment points. The GUI reports whether it is possible to proceed: the
      number of connections (in green) or an error message (in red).</td>
    </tr>
    <tr>
      <td><b>Specify connection points</b></td>
      <td>This radio button specifies how attachment points are
      identified. If <b>Selected Atoms</b> is pressed, selected terminal atoms
      or free rotors are used. If <span class="nobr"><b>Atom Names</b></span>
      is pressed, terminal atoms or rotors with names of <b>A1...An</b> are
      used. Valid attachment points are labeled in green, and the GUI indicates
      the number of connections and whether the calculation can proceed.</td>
    </tr>
    <tr>
      <td><b>Attach <span class="nobr">R-groups</span></b></td>
      <td>
        The <b>Define Connections</b> button allows the user to associate
        R-group libraries with individual attachment points and provides the
        number of possible combinations. The following panel appears:

	<img src=
        "frag_combi/fcdefineconn.png" alt="Define Connections Panel"
	class="center" />

        <table class="noborder">
          <tr>
            <td><b>R-group</b></td>
            <td>This file browser allows the user to select
            R-group libraries. Double-click on individual databases to add them
            using the next available attachment point.</td>
          </tr>
          <tr>
            <td><b>Add Connection</b></td>
            <td>Adds the currently selected database as an R-group
            library using the next available attachment point.</td>
          </tr>
          <tr>
            <td><b>Connections</b></td>
            <td>This lists R-group libraries associated with each
            attachment point and whether only the selected entries in the
            database will be used (selections made in the Database Viewer). The
            maximum number of combinations due to the current selection is also
            provided.</td>
          </tr>
          <tr>
            <td><b>Remove</b></td>
            <td>Deletes the selected entries of the Connections
            list.</td>
          </tr>
          <tr>
            <td><b>Refresh</b></td>
            <td>Pressing Refresh recalculates the maximum number
            of combinations and would be used to update the value after
            changing R-group selection in the Database Viewer.</td>
          </tr>
          <tr>
            <td><b>Change Ports</b></td>
            <td>Pressing one of these buttons changes the
            attachment point of a selected entry in the Connections list. A
            warning will appear if the new attachment point is in use.</td>
          </tr>
<!--
          <tr>
            <td><b>Use selected entries only</b></td>
            <td>If on, only the selected entries of the specified
            R-group libraries will be used. If the library is not open in the
            Database Viewer, all entries will be used. This is applied to all
            selected entries in the Connections list.</td>
          </tr>
-->
          <tr>
            <td><b>Set Atom Names</b></td>
            <td>Set the atom names of the Ligand atom set to
            reflect the currently active connection points. Atom names of
            <b>A1...An</b> are changed to their element symbol if
            inactive.</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td><b>Configure...</b></td>
      <td>
        This button brings up a sub-panel, allowing the user to change some
        of the more technical parameters for the Combinatorial Builder:

	<img src="frag_combi/fcsettings.png" alt="Settings Panel
	"class="center"/>

        <table class="noborder">
        <tr>
          <td><b>Intra-Ligand Clash Energy</b></td>
          <td>Sets the intra-ligand soft clash energy threshold
          (in kcal/mol/ligand atom). This calculation is done over the
          R-group atoms.</td>
        </tr>
        <tr>
          <td><b>Protein-Ligand Clash Energy</b></td>
          <td>Sets the protein-ligand soft clash energy
          threshold (in kcal/mol/ligand atom). This calculation is done over
          the R-group atoms.</td>
        </tr>
        <tr>
          <td><b>Scaffold Atom Tether</b></td>
          <td>If specified, a fixed-value tether is used for
          refinement and minimization.</td>
        </tr>
        <tr>
          <td><b>Duplicate Window</b></td>
          <td>Sets the threshold (RMSD value) below which new
          structures will be considered duplicates of those generated
          previously.</td>
        </tr>
        <tr>
          <td><b>Clash Grid Energy Threshold</b></td>
          <td>The maximum soft clash energy (in kcal) used by
          the Torsion Driver when determining accessible regions of
          space.</td>
        </tr>
        <tr>
          <td><b>Torsion Driver Stepsize</b></td>
          <td>The stepsize (in degrees) used by the Torsion
          Driver when generating rotamers of individual bonds.</td>
        </tr>
        <tr>
          <td><b>Rotamer Energy Threshold</b></td>
          <td>The energy threshold (in kcal) used by the Torsion
          Driver when discarding higher-energy rotamers. This is calculated
          using the current forcefield.</td>
        </tr>
        <tr>
          <td><b>Rotamer Duplicate Window</b></td>
          <td>The threshold (in degrees) used by the Torsion
          Driver when determining duplicate rotamers. The lowest-energy
          structure within the duplicate window is used.</td>
        </tr>
        <tr>
          <td><b>Variable terminal rotors</b></td>
          <td>If on, multiple attachment point positions will be
          generated for terminal free rotors. Otherwise, the specific input
          positions will be used.</td>
        </tr>
        <tr>
          <td><b>Write R-group molecules</b></td>
          <td>If on, the R-groups will be written to the output
          database as molecules. Otherwise, only R-group names are written
          out.</td>
        </tr>
        <tr>
          <td><b>Heavy Atom Connections</b></td>
          <td>If on, attachment points will be treated as heavy atoms
	  when determining whether terminal rotors are present.</td>
        </tr>
      </table>
      Note that atoms labeled as attachment points that are not involved
      in the calculation are retained in the product(s).
      </td>
    </tr>
    <tr>
      <td><b>Descriptor Filter</b></td>
      <td>
        If specified, this defines the criteria that generated molecules must
        satisfy. Molecules whose properties fall outside the specified range(s)
        will be omitted. Any MOE QuaSAR descriptor can be specified and the
        condition to be satisfied can be a range of values, a Boolean value,
        numeric comparisons, etc. evaluated on descriptors or SMARTS patterns.
        Descriptor Filters can include files, specified as
        <tt>@<i>filename</i></tt>. If the filename contains spaces or other
        non-alphanumeric characters, it must be enclosed in double quotes.
        Files can be nested. The current Filter can be written to a file by
        pressing <b>Save...</b> and providing a filename. Examples include:
        <table class="titlebar">
          <tr>
            <th>Expression</th>
            <th>Meaning</th>
          </tr>
          <tr>
            <td><tt>Weight[100,500] SlogP&lt;5</tt></td>
            <td>Molecular weight &ge; 100 and &le; 500 and SlogP &lt; 5</td>
          </tr>
          <tr>
            <td><tt>!reactive 'b_1rotN'&lt;4</tt></td>
            <td>Not reactive and less than 4 rotatable single bonds<br />
            (<b>Note:</b> Descriptor codes containing digits must be
            quoted.)</td>
          </tr>
          <tr>
            <td><tt>&quot;[NX3](=[OX1])[OX1]&quot;&lt;=2 not
            &quot;[#M]&quot;</tt></td>
            <td>Two or fewer nitro/nitrate groups and not metal atom</td>
          </tr>
          <tr>
            <td><tt>@filter.txt TPSA&gt;80</tt></td>
            <td>Use the contents of <tt>filter.txt</tt> and TPSA &gt; 80</td>
          </tr>
        </table><br />
        If a Descriptor Filter is specified, the color of the <b>Check
        Filters</b> button indicates whether the input ligand passes (black) or
        fails (red). Clicking the button displays in the MOE window the
        Descriptor values and indicates whether the ligand passes the Model or
        Pharmacophore filters.
      </td>
    </tr>
    <tr>
      <td><b>Model file</b></td>
      <td>Output molecules may optionally be filtered with a QSAR
      <tt>.fit</tt> file, a Model Composer <tt>.mom</tt> file, a Fingerprint
      Model <tt>.fpt</tt> file or a Pharmacophore Query <tt>.ph4</tt> file.
      Specify the name of an existing file, or click on <b>Browse...</b> to
      select a file. Generated molecules that fail to satisfy the given
      threshold condition (specified in the fields below) will be omitted.</td>
    </tr>
    <tr>
      <td><b>Pharmacophore</b></td>
      <td>If specified, the pharmacophore query to be used as a
      filter. Specify the name of an existing file or open the <a href=
      "ph4_query.htm">Pharmacophore Query Editor</a> by pressing
      <b>Editor...</b> to create or edit a query. Molecules whose absolute
      coordinates fail to satisfy the pharmacophore filter will be
      omitted.</td>
    </tr>
    <tr>
      <td><b>Output Database</b></td>
      <td>
        The Output Database contains the structures created by the
        Combinatorial Builder along with various calculated properties. If
        <b>Open Database Viewer</b> is on then a molecular Database Viewer will
        be opened with the output database. If <b>Minimize generated
        structures</b> is on and a Receptor is present, <b>Forcefield
        Refinement</b> will be used. Use the <b>Configure...</b> button to
        modify the parameters, or to enable sidechain flexibility.

<p>If no Receptor is present, tethered minimization (using the current
        forcefield) with a variable force constant will be used to generate
        relaxed structures with as little global change in scaffold geometry as
        possible. A parabolic force constant, <span class="nobr"><i>k</i> =
        <i>5r <sup>2</sup></i></span>, is applied to each
        scaffold atom, where <i>r</i> is the minimum distance to a connection
        point. If a Pharmacophore Filter is present, its features will be used
        as constraints in both refinement and minimization.</p>
      </td>
    </tr>
    <tr>
      <td><b>Scoring</b></td>
      <td>Specifies which <a href="docking.htm#Computational_Background">scoring
      methodology</a> to use for ranking the structures created by the
      Combinatorial Builder. Use the <b>Configure...</b> button to the right to
      configure the parameters of the selected method (if appropriate).</td>
    </tr>
    <tr>
      <td><b>Isolate</b></td>
      <td>Press the <b>Isolate</b> button to render the molecular
      system near the Ligand atom set and hide the remaining atoms of the
      system.</td>
    </tr>
    <tr>
      <td><b>Batch</b></td>
      <td valign="top">Opens the
      <a href="../moe/hpc.htm#BatchPanel">Batch</a> job submit
      panel, which allows the user to create
      a batch job that can be run locally outside of MOE,
      or on a compute cluster via a queueing system such as slurm:

      <img src="frag_combi/batchpanel.png" alt="Batch Panel" class="center" />

      The default job directory name will reflect the output database.
    </tr>
    <tr>
      <td valign="top"><b>Load</b></td>
      <td valign="top">Pressing the <b>Load</b> button allows the user to
      open a batch job directory and load its information:

      <img src="frag_combi/loadbatch.png" alt="Load Batch" class="center" />

      This loads the starting structure into the MOE system or opens
      the input database file (as appropriate), and restores the panel settings.
    </tr>
    <tr>
      <td><b>Close</b></td>
      <td>Press the <b>Close</b> button to exit the Combinatorial
      Builder. This does not terminate the current search.</td>
    </tr>
  </table>

<p>After filling in the appropriate entries, press <b>Search</b> to start the
  calculation. Progress information is provided in the SVL Commands window
  along with the bottom of the panel (if open). Pressing <b>Stop Search</b>
  while the calculation is running terminates the search. If the Combinatorial
  Builder application has been closed, the current search can be terminated via
  <span class="menu">MOE | Cancel</span>, by selecting <span class=
  "nobr"><b>Combinatorial Builder Search</b></span>.
  Upon completion, the output database will contain the following
  fields:</p>
  <table class="titlebar">
      <tr>
        <th>field</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><b>mol</b></td>
        <td>A molecule field containing the structures generated
        by the Combinatorial Builder.</td>
      </tr>
      <tr>
        <td><b>mseq</b></td>
        <td>The molecular sequence number, starting at 1 and
        incrementing with every new molecule. Conformers share mseq
        values.</td>
      </tr>
      <tr>
        <td><b>ERgr</b></td>
        <td>The energy of the R-group(s), which is the sum of the
        R-group/receptor interaction energy (if present), the conformation
        energy penalties for each R-group and the inter-R-group conformation
        energy penalty (if present).</td>
      </tr>
      <tr>
        <td><b>AcidBase</b></td>
        <td>The strong acid/base warning flag, set to 1 when
        acidic or basic atoms are present (those whose protonation state would
        be changed when washed).</td>
      </tr>
      <tr>
        <td><b>rsynth</b></td>
        <td>The synthetic feasibility score, which is the fraction
        of the atoms of each new structure that ultimately appear in a
        retrosynthetic fragment found in the starting materials database. A
        value of one indicates that the molecule is very likely
        synthesizable.</td>
      </tr>
      <tr>
        <td><b>Rgroup<i>n</i></b></td>
        <td>The R-group(s) used to create the current structure.
        This can be the actual molecule (default) or the name of the particular
        R-group.</td>
      </tr>
      <tr>
        <td><b>PH4 RMSD</b></td>
        <td>The RMS deviation of the fit of the output molecule to
        the pharmacophore filter (if present).</td>
      </tr>
      <tr>
        <td><b>RMSD</b></td>
        <td>The RMS deviation of the heavy atoms of the scaffold
        before and after minimization (if performed).</td>
      </tr>
      <tr>
        <td><b>MM/GBVI</b></td>
        <td>If <b>Forcefield Refinement</b> is performed, this is
        a measure of the non-bonded interaction between the receptor and
        ligand. It is the sum of van der Waals, Coulomb and generalized Born
        implicit solvent interaction energies. If <b>Use GB/VI</b> is
        deselected, the protein/ligand energy using the current forcefield is
        reported as <b>E_refine</b></td>
      </tr>
      <tr>
        <td><b>receptor</b></td>
        <td>If <b>Forcefield Refinement</b> is performed with
        sidechain flexibility, this contains the revised coordinates of the
        receptor.</td>
      </tr>
      <tr>
        <td><b><i>score</i></b></td>
        <td>If Scoring is used, this field contains the specific
        score value <b>ASE</b>, <b>Affinity dG</b>, <b>Alpha HB</b>,
        <b>GBVI/WSA dG</b> or <b>London dG</b>. If <b>London dG</b> scoring is
        used, the <b>Ligand Efficiency</b> is calculated for the output
        structures as well.</td>
      </tr>
    </table>

<p>If Descriptor or Model filtering is used, additional columns are created
  in the output database to receive the various calculated properties. This
  database can be analyzed using any of the other analysis tools in MOE.
  <!-- =============================== EXAMPLE ============================= --></p>
<a id="Example"></a>
<h1>Examples</h1>

<p>In this section we will present a number of example calculations using the
  Combinatorial Builder, using both user-specified and default R-group
  libraries.</p>
  <div class="example">

<h2>Prepare Input</h2>
    <ol start="1">
      <li>
	<p><i>Prepare the protein/ligand pair.</i></p>
        <p>First, clear the system:</p>
<p class="indent_novspace"><span class="menu">MOE | File |
        Close</span></p>

        <p>Open the PDB file:</p>
<p class="indent_novspace"><span class="menu">MOE | File | Open</span></p>

	<p>In the Open panel, select <span class=
        "nobr"><tt>$MOE/sample/mol/1ioe.pdb.gz</tt></span> and press
	<b>OK</b>.</p>

        <p>Set the optimal protonation state:</p>
<p class="indent_novspace"><span class="menu">MOE | Compute | Prepare |
        Protonate 3D</span></p>

	<p>Take the default options and press <b>OK</b>.
        This will take a minute or so to complete.</p>

        <p>Hide the Receptor, ribbons and hydrogen atoms:</p>

<p class="indent_novspace"><span class="menu">RHS | Hide |
        Receptor</span></p>

<p class="indent_novspace"><span class="menu">MOE | Footer | Ribbon |
        Style | <img src="frag_combi/apat_image011.png" alt="ribbon style"
        class="icon" /></span></p>

<p class="indent_novspace"><span class="menu">RHS | Hydrogens</span></p>

        <p>Select and delete pyridine terminal group:</p>
<p class="indent_novspace"><span class="menu">RHS |
        Delete</span></p>
	<p>This creates a hydrogen that will be used in the next
        two examples.</p>
        <p>Save it to disk:</p>

<p class="indent_novspace"><span class="menu">MOE | File |
        Save</span></p>
	<p>In the Save panel, enter <span class=
        "nobr"><tt>CBtest.moe</tt></span>. This can be used when rerunning the
        sample calculations.</p>
      </li>
      <li>
        <p><i>Start the Combinatorial Builder.</i></p>

<p class="indent_novspace"><span class="menu">MOE | Compute | Fragments
        | Combinatorial Builder</span></p>
	<p>Ensure that the Receptor set is set
        to Receptor Atoms and the Ligand set is set to Ligand Atoms. Toggle on
        <span class="nobr"><b>Open Database Viewer</b></span> to see the output
        as it is created.</p>
      </li>
    </ol>
  </div>
  <div class="example">

<a id="simpleAddition"></a>
<h2>Simple Addition</h2>
    <ol start="1">
      <li>
        <div class="floatright"><img src="frag_combi/selpix1.jpg" alt=
        "Single Bond Selection" class="floatright" /></div>
	<p><i>Decrease the filtering.</i></p>
        <p>Change the <b>Descriptor Filter</b> to <tt>Weight&lt;600</tt>
        <tt>SlogP[-4,8]</tt> <tt>TPSA[40,140]</tt>. This increases the maximum
        molecular weight that will be accepted.</p>
      </li>
      <li><p><i>Set up the calculation.</i></p>
      <p>Select the hydrogen created when setting up <span class=
      "nobr"><tt>CBtest.moe</tt></span> (it should be the only one visible).
      The atoms should be labeled <font color="#00CC00"><b>A1</b></font> and
      the GUI will indicate a single connection is present.</p></li>
    </ol>

<p>Press <b>Search</b> to start the Combinatorial Builder. The calculation
    will run quickly as the default library, <span class=
    "nobr"><tt>$MOE/lib/buildfrag.mdb</tt></span>, is small. Progress is
    reported at the bottom of the GUI. The output molecules have molecular
    weights less than 600, logP's in the range of -4 to 8 and TPSA in the
    range of 40 to 140. The <span class="nobr"><b>SVL Commands</b></span>
    window provides information about the calculation.</p>
  </div>
  <div class="example">

<a id="variableRotor"></a>
<h2>Variable Free Rotor</h2>
    <ol start="1">
      <li>
        <div class="floatright"><img src="frag_combi/selpix2.jpg" alt=
        "Free Rotor Selection" class="floatright" /></div>
	<p><i>Show the hydrogens.</i></p>
        <p>Clear the atom selection, and display the hydrogens:</p>
	<p class="indent_novspace">
	<span class= "menu">RHS | Hydrogens</span></p>
      </li>
      <p><li><i>Set up the calculation.</i></p>
      <p>Select one of the hydrogens of the terminal methyl group. As above, the
      GUI will indicate a single connection is present.</p></li>
    </ol>

<p>Press <b>Search</b> to start the Combinatorial Builder. The portion of
    the scaffold containing the selected atom is outside the cleft, so it is
    likely that the <b>-O-CH<sub>3</sub></b> rotor will have several possible
    positions. The calculation should take less than a minute, with progress
    reported at the bottom of the GUI and in the <span class="nobr"><b>SVL
    Commands</b></span> window.
    You can examine the output, <tt>combibuild.mdb</tt> in the Database
    Viewer. There are a few thousand structures, with multiple rotamers
    associated with each R-group. Browsing the first few structures shows the
    orientations for each generated attachment point.</p>
  </div>
  <div class="example">

<a id="combiBuilding"></a>
<h2>Combinatorial Building</h2>
    <ol start="1">
      <li>
        <p><i>Load the scaffold.</i></p>
        <p>First, clear the system:</p>

<p class="indent_novspace"><span class="menu">RHS |
        Close</span></p>
        <p>Open the scaffold database:</p>

<p class="indent_novspace"><span class="menu">RHS | Open</span></p>
	<p>In the Open panel, select <span class=
        "nobr"><tt>$MOE/sample/mol/gmp_scaffold.mdb</tt></span> and press
        <b>OK</b>.<br />
        Double click on the molecule to load it into MOE.</p>
      </li>
      <li><p><i>Specify the connections</i></p>
      <p>Press <b>Define Connections...</b> in the GUI. This brings up the
      <span class="nobr"><b>Edit Connections</b></span> window. In the
      <b>R-group</b> file browser, enter <span class=
      "nobr"><tt>$MOE/sample/mol</tt></span> and hit return. This shows a
      collection of databases under <b>Files</b>.
      The four R-group libraries are <tt>gmp_r1.mdb</tt>,
      <tt>gmp_r2.mdb</tt>,
      <tt>gmp_r3.mdb</tt> and <tt>gmp_r4.mdb</tt>. Select each in turn and
      press <span class="nobr"><b>Add Connection</b></span> or by
      double-clicking in the file list. The panel should look like this:</p>
      <img src="frag_combi/EditSel.png" alt="Connections Panel" class="center" />
      <p>Press <b>OK</b> to accept the connections.</p></li>
      <li>
        <div class="floatright"><img src="frag_combi/selpix3.jpg" alt=
        "Atom Name Selection" class="floatright" /></div>
	<p><i>Increase the filtering.</i></p>
        <p>Change the <b>Descriptor Filter</b> to <tt>Weight&lt;250</tt>. This
        decreases the maximum molecular weight that will be accepted and
        removes the logP and TPSA filters.</p>
      </li>
      <li><p><i>Set up the calculation.</i></p>
      <p>Change the Receptor Atom set to <b>None</b>.<br />
      Change <b>Specify connection points</b> to <b>Atom Names</b>. The atoms
      with names <b>A1...A4</b> are labeled in green. The GUI indicates there
      are 4 Connections and 6480 possible combinations to examine.</p></li>
    </ol>

<p>Press <b>Search</b> to start the Combinatorial Builder. The calculation
    should take a few seconds, and generate roughly a thousand structures.
    Progress is reported at the bottom of the GUI and in the <b>SVL
    Commands</b> window.
    You can examine the output, <tt>combibuild.mdb</tt> in the Database
    Viewer. As no receptor is present, <b>ERgr</b> (the R-group energies)
    reflects only R-group/scaffold and R-group/R-group conformation energy
    penalties. You can extend the size of the <b>mol</b> field to see which
    R-groups were used to create each output molecule, or browse the results to
    see the various structures and rotamers that were generated.</p>
  </div>
  <!-- ============================= REFERENCES ============================ -->

<a id="Ref"></a>
<h1>References</h1>
  <table class="ref">
    <tr>
      <td>[Labute&nbsp;2008]</td>
      <td>Labute, P.; The Generalized Born/Volume Integral
      Implicit Solvent Model: Estimation of the Free Energy of Hydration Using
      London Dispersion Instead of Atomic Surface Area; <i>J. Comput. Chem.
      29</i> (<b>2008</b>) 1693&ndash;1698.</td>
    </tr>
  </table>

<a id="seeAlso"></a>
<h1>See Also</h1>

<p><a href="../moe/molsystems/build.htm#CombiBuild">
    Building and Editing Molecules</a><br />
  <a href="../quasar/fcnref/descrfcn.htm">QuaSAR-Descriptor
  Functions</a><br />
  <a href="../quasar/descr.htm">QuaSAR-Descriptor</a><br />
  <a href="ph4_guide.htm">Introduction to Pharmacophores in MOE</a><br />
  <a href="../moe/hpc.htm">High-Performance Computing Framework</a></p>

  <!-- START MOE_FOOTER -->
  <div class="MOE_FOOTER">
    <img src="../images/ccgicon.png" /> <a href="../index.htm"></a> <a href=
    "../legal.htm"></a> &copy;<span class="versionyear"></span> <a href="http://www.chemcomp.com"></a>. All
    rights reserved.<br />
    <a href="mailto:info@chemcomp.com"></a>
  </div><!-- END MOE_FOOTER -->
</div>
</div>
</body>
</html>

