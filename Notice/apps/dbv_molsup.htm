<!DOCTYPE html>
<html>

<!--
!!    MOE On-Line Manuals
!!    COPYRIGHT (C) CHEMICAL COMPUTING GROUP ULC.  ALL RIGHTS RESERVED.
!!-->
<head>
  <meta http-equiv="x-ua-compatible" content="IE=9" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../include/manstyle.css" />
  <link rel="icon" type="image/png" href="../images/ccgicon.png" />
  <link rel="shortcut icon" type="image/png" href="../images/ccgicon.png" />
  <meta name="keywords" content="panel: Molecule Superpose" />
  <title>Molecule Superpose</title>
</head>
<body>
<div class="center-page">
  <!-- START MOE_HEADER -->
  <div class="MOE_HEADER">
    <a href="../index.htm"><img src="../images/ccglogo.png" /></a>
    <a href="../index.htm"><div class="moeversion"></div></a>
    Molecule Superpose
  </div>
<!-- END MOE_HEADER -->
<div class="content">

<div class="toc-wrap" id="toc-list">
<ul class="tight">
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Methodology">Methodology</a>
<div class="tocSubitems">
<a href="#SelectedAtoms">Selected Atoms</a> |
<a href="#SubstructureSearch">Substructure Search</a> |
<a href="#Similarity">Similarity</a> |
<a href="#Conformers">Conformers</a>
</div>
</li>
<li><a href="#RunningMoleculeSuperpose">Running Molecule Superpose</a></li>
<li><a href="#Examples">Examples</a>
<div class="tocSubitems">
<a href="#SMARTSQuery" class="example">SMARTS Query</a> |
<a href="#TripQuery" class="example">Similarity Query</a>
</div>
</li>
</ul>
</div>

<a id="Introduction">
<h1>Introduction</h1>
</a>

<p>The Molecule Superposition application is used to superpose a set of 3D
  molecules contained in a database onto one or more reference structures (or
  templates). The resulting alignments are ranked by a scoring function similar
  to that of <a href="flex.htm">FlexAlign</a> using both atom-centered and
  projected feature terms along with the MSD of the superposition. An
  additional protein/ligand clash term is added to this scoring function when
  used in <a href="docking.htm">Docking's</a> <span class=
  "nobr"><b>Template Forcing</b></span> or <span class="nobr"><b>Template
  Similarity</b></span> placement methods.</p>

<p>The atom correspondences needed for superposition can be determined by a
  number of query methods: (1) matching a subset defined by atom selection,
  SMARTS or sketched queries, (2) an undirected heavy-atom and projected
  feature triplet matching scheme or (3) matching conformers of the template
  structure(s). The resulting aligned structures can be used as input for MOE
  applications such as <a href="ph4_query.htm#ConsensusMethod">Pharmacophore
  Consensus</a>, <a href="ph4_query.htm">Pharmacophore Query Editor</a> or
  <a href="breed.htm">BREED</a>.
</p>

<a id="Methodology">
<h1>Methodology</h1>
</a>

<p>The Molecular Superposition process starts with one or more user-specified
  templates. These can be complete molecules, molecular fragments or sets of
  disconnected fragments. These define the coordinate system for the aligned
  results and contain the atoms that will be used to superpose structures. As
  the similarity score uses all atoms of the template input structures, those
  not involved in the actual superposition will contribute towards ranking the
  results (via their volume, heteroatomic substitution and pharmacophore
  patterns).</p>

<p>The <a href="../moe/fcnref/superpos.htm">Superpose</a> function requires
  two or more sets of atomic coordinates to align structures, generated by
  identifying the corresponding atoms in each structure. It returns the RMSD
  match of the resulting alignment. Molecular Superposition performs pairwise
  superpositions, using a fixed template to which the input molecule is
  aligned. The atom correspondence can be determined by a number of query
  methods:</p>

<a id="SelectedAtoms">
<h2>Selected Atoms</h2>
</a>

<p>This method uses the selected atoms of the main MOE window to generate
  search queries. Note that selecting a portion of a molecule can yield
  different atom types and/or bonds as compared to the complete structure. Each
  query is used to search the input structures for those containing an exact
  match of the atoms and bonds of the selected atoms of the template. Each
  match defines the atom correspondence used to superpose the two molecules.
  The results are scored, duplicate checked, and kept if appropriate.</p>

<a id="SubstructureSearch">
<h2>Substructure Search</h2>
</a>

  <div class="floatright"><img src="dbv_molsup/search1_crop.png" alt=
  "Sample sketched query" class="floatright" /></div>

<p>The <b>SMARTS</b> and <b>Sketch</b> query methods allow the user to define
  the substructure via a user-defined query. The <a href=
  "../moe/fcnref/smartsfcn.htm#Description">SMARTS language</a> provides a
  powerful, flexible means of searching chemical structures. For example,
  <tt>c1cccca1</tt> will match either phenyl or pyridyl groups. Alternatively,
  the user can enter a query via a <span class="nobr"><a href=
  "../moe/extprog.htm#2DSketchers">2D sketcher</a></span>. This is a more
  familiar way of dealing with chemical structures. The query to the right will
  also match phenyl or pyridyl groups. Both methods support atom and bond
  wildcards and other more complex search query features.</p>

<p>Using these methods, atom correspondences are generated by finding each
  occurrence of the query in each template and matching these to each
  occurrence of the query in the input structure. For example, the SMARTS
  string, <tt>*1~*~*~*~*~*1</tt>, will find six-membered rings. Given the
  following template and input structures:</p>
<table class="noborder">
  <tr>
    <td><img src="dbv_molsup/ref1_crop2.png" class="icon"/></td>
    <td><img src="dbv_molsup/input1_crop2.png" class="icon"/></td>
  </tr>
  <tr>
    <td><p class="caption">Reference</p></td>
    <td><p class="caption">Input</p></td>
  </tr>
</table>

<p>two rings are found in the template and three in the input structure
  (circled in <font color="red">red</font>). This results in at least 6 sets of
  matches, with each containing various atom correspondences. Two alignments
  are shown below:</p>
<table class="noborder">
  <tr>
    <th><img src="dbv_molsup/best1_crop2.png" class="icon" /></th>
    <th><img src="dbv_molsup/alt1_crop2.png" class="icon" /></th>
  </tr>
  <tr>
    <td><p class="caption">Best Score</p></td>
    <td><p class="caption">Alternate</p></td>
  </tr>
</table>

<p>As phenyl and pyridyl are quite similar, superposing both pairs of
  structures (<font color="red">red</font> circles) yielded a small RMSD match.
  In the best-scoring case, all the branches off the phenyl ring are
  superimposed and more importantly, a number of heteroatoms and pharmacophore
  features are aligned. While the alternate structure has several superimposed
  atoms, the heteroatoms and pharmacophore features do not correspond well.
  Each alignment is scored, duplicate checked, and kept if appropriate.</p>

<a id="Similarity">
<h2>Similarity</h2>
</a>

<p>All of the methods described above require information about the size and
  nature of the common substructure used for alignment. As the experimental
  data might not be available, Molecular Superposition provides an undirected
  search method that performs an exhaustive search based on matching triplets
  of heavy atoms and projected features. This ensures an unbiased coverage of
  the search space. Each input structure will be aligned against each template
  in turn by the following process:</p>
  <ol>
    <li>Randomly select a template.</li>
    <li>Randomly select a conformer of the input structure.</li>
    <li>Randomly select an atom triplet in the conformer from (1).</li>
    <li>Randomly select an atom triplet in the template structure from (1) such
    that atoms match atoms and projected features match projected
    features.</li>
    <li>Superpose the triplet pairs and score the results. Set the failure
    count to zero if the score falls within the user-specified thresholds,
    otherwise add one to the failure count.</li>
    <li>Repeat steps (1)&nbsp;-&nbsp;(5) until the failure count exceeds the
    user-specified rejection limit.</li>
  </ol>

<p>The results are sorted and duplicate results are removed as the
  calculation proceeds. A sample atom triplet is shown below:</p>

<img src="dbv_molsup/trip1_crop.png" alt="Sample atom triplet" class="center" />

<a id="Conformers">
<h2>Conformers</h2>
</a>

<p>This method assumes that the input database contains one or more
  conformers of the template(s) (i.e. the same atoms in the same order with
  different coordinates). Each pair of conformers is superposed and the results
  are scored by RMSD. Input structures that are not conformers of one of the
  templates are ignored.</p>

<p>All these query methods generate a list of positions for each input
  structure along with the best-matching template. These are ordered by
  increasing score with the best result (along with scoring information)
  written to the input database. If desired, the best-scoring position of each
  input molecule can be refined against the best-matching template with
  FlexAlign. During this refinement the template is held rigid while the
  best-scoring match can be rigid or flexible.
</p>

<a id="RunningMoleculeSuperpose">
<h1>Running Molecule Superpose</h1>
</a>

<p>To start the Molecule Superpose application, open a database of the
  structures to be superposed. If desired, load the template(s) into the main
  MOE window and select <span class="menu">DBV | Compute | Molecule |
  Superpose</span> to start the application:</p>

<img src="dbv_molsup/panel1.png" alt="Molecule Superpose Panel" class="center" />
<table class="noborder">
  <tr>
    <td><b>Database</b></td>
    <td>This is the name of the input database containing the
    structures to be superposed. One or more data fields will be added to
    this database as the application proceeds.</td>
  </tr>
  <tr>
    <td><b>Selected Entries Only</b></td>
    <td>If on, only the selected entries in the Database Viewer
    of the input database are used (the rest are ignored).</td>
  </tr>
  <tr>
    <td><b>Molecule</b></td>
    <td>This specifies the database field that contains the
    input structures. By default it is the first available structure field.
    The shortcut contains all the structure fields in the input
    database.</td>
  </tr>
  <tr>
    <td><b>Output</b></td>
    <td>This specifies the database field that will contain the
    aligned (output) structures. It is used as a prefix for whatever
    additional information fields are generated during the calculation. If
    omitted, the output structures will be written to the input field.</td>
  </tr>
  <tr>
    <td><b>Ligand Only</b></td>
    <td>If on, only ligand atoms in the database entries will be used to
    determine the superposition, but the whole entry structure will be
    reoriented together with the superposed ligand.</td>
  </tr>
  <tr>
    <td><b>Template</b></td>
    <td>The atoms that define the template structure(s) that
    will be used by Molecule Superpose. Press the <b>?</b> button to the
    right to briefly highlight (in the MOE window) the specified atoms. The
    template(s) can be read from a file by choosing <b>File</b> from the
    dropdown menu and pressing <b>Browse...</b> to select the appropriate MDB
    file. It can also be entered into the text field. Each MDB entry is
    assumed to be a single template. The first field of type
    <tt>molecule</tt> or <tt>moe</tt> is used as the template field.</td>
  </tr>
  <tr>
    <td><b>Query</b></td>
    <td>
      The method used to identify the atom correspondences needed to
      superpose the input structures on the template(s):
      <table class="noborder">
        <tr>
          <td><b>Selected Atoms</b></td>
          <td>A query is generated from the selected atoms in
          the main MOE window and used to search both the template(s) and the
          input structure. If <b>Ignore Hydrogens</b> is on, hydrogens among
          the selected atoms will be ignored.
          Every match of the template(s) is compared to
          every match of the input structure, the corresponding atoms are
          superposed and the resulting alignment is scored.</td>
        </tr>
        <tr>
          <td><b>SMARTS</b></td>
          <td>The SMARTS string entered in the adjacent text box
          is used to search both the template(s) and the input structure.
          Every match of the template(s) is compared to every match of the
          input structure, the corresponding atoms are superposed and the
          resulting alignment is scored. Invalid SMARTS strings are
          highlighted in <font color="red">red</font> as an aid in
          constructing queries.</td>
        </tr>
        <tr>
          <td><b>Sketch</b></td>
          <td>Pressing <b>Sketch...</b> opens an external 2D
          sketcher to let the user graphically define their query. The query
          is used to search both the template(s) and the input structure.
          Every match of the template(s) is compared to every match of the
          input structure, the corresponding atoms are superposed and the
          resulting alignment is scored. Consult <span class="nobr"><a href=
          "../moe/extprog.htm#2DSketchers">2D Sketchers</a></span> for more
          information on configuring and using sketchers with MOE.</td>
        </tr>
        <tr>
          <td><b>Similarity</b></td>
          <td>Random, similar heavy-atom and projected feature
          triplets are selected from both the input and templates. The
          triplets are superposed and the resulting alignment is scored.</td>
        </tr>
        <tr>
          <td><b>Conformers</b></td>
          <td>Input molecules that are conformers (i.e. the same
          atoms in the same order with differing coordinates) of one of the
          templates are superposed by atom order and the resulting alignment
          is scored.</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td><b>Refine With FlexAlign</b></td>
    <td>If on, superposed structures will be refined against the
    corresponding template using FlexAlign. The template is held rigid and
    the input molecule can be rigid or flexible during this calculation. The
    result will be written to the   output field.

    <b>Rigid Body</b>, if on, specifies that the input molecule will be kept
    rigid.

    <b>Calculate Partial Charges</b>, if on, specifies that partial charges
    using the current forcefield will be calculated before refining with
    FlexAlign.

    The FlexAlign parameters and scoring function terms and weights can be
    set by pressing the configure icon. This brings up the <a href=
    "flex.htm#SettingsPanel">Flexible Alignment Settings</a> panel.</td>
  </tr>
</table>

<p>After setting the various options as desired, press <b>Apply</b> or
  <b>OK</b> to start the calculation. Pressing <b>Apply</b> keeps the
  <span class="nobr"><b>Molecule Superpose</b></span> panel open, while
  <b>OK</b> closes it. Progress information is provided in the MOE Window as
  well as the SVL Commands Window. Pressing <span class="nobr"><b>Stop
  Superpose</b></span> terminates the calculation. The superposition will
  reorient all atoms of the structures in the database entries as well as
  graphical objects, if present (e.g. in <tt>moe</tt> fields).<p>
<p>
  Upon completion, the
  database will contain the following additional fields (assuming
  <tt>mol_super</tt> is the <b>Output</b> field name:</p>
  <table class="titlebar">
      <tr>
        <th>field</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><b>mol_super</b></td>
        <td>A molecule field containing the best-scoring aligned
        structure generated by Molecule Superpose.</td>
      </tr>
      <tr>
        <td><b>mol_super_score</b></td>
        <td>The overall score for the aligned structures. This is
        constructed as a weighted sum of the similarity and RMSD scores, with
        both terms having similar magnitude.</td>
      </tr>
    </table>

<a id="Examples">
<h1>Examples</h1>
</a>

<p>In this section we will present a number of example calculations using the
  Molecule Superpose application.</p>
  <div class="example">

<a id="SMARTSQuery">
<h2>Example: SMARTS Query</h2>
</a>
    <ol start="1">
      <li>
        <i>Create a local copy of the input database.</i>
        First clear the system:

<p class="indent_novspace"><span class="menu">RHS |
        Close</span></p>
        Open the input database:

<p class="indent_novspace"><span class="menu">RHS | Open</span></p>In
        the Open panel, select <span class=
        "nobr"><tt>$MOE/sample/mol/1RO6_ligands.mdb</tt></span> and press
        <b>OK</b>.

        Save it to disk:

<p class="indent_novspace"><span class="menu">DBV | File | Save
        as...</span></p>In the Save panel, enter <span class=
        "nobr"><tt>1ro6_ligands.mdb</tt></span> and press <b>OK</b>. This will
        be used throughout the sample calculations.

  </li>
      <br /><li><i>Load the template into MOE.</i><br /><br />
      Double-click on the first entry of the <tt>mol</tt> column, named
      <tt>1RO6</tt>.
  </li>
      <br /><li>
        <i>Start Molecule Superpose</i>

<p class="indent_novspace"><span class="menu">DBV | Compute | Molecule
        | Superpose...</span></p>
  </ol>
      <p>Specify the SMARTS substructure by changing <b>Query</b> to
      <b>SMARTS</b>, and entering
      <tt>c1ccccc1</tt> in the text box to search for a phenyl group.
      Notice that the string turns <font color="red">red</font> as you are
      entering it as the partial string is invalid.  Change the name of
      the <b>Output</b> to <tt>mol_super</tt>.
    Press <b>OK</b> to start the Molecular Superpose calculation. This
    writes two fields to the input database: <tt>mol_super</tt> and
    <tt>mol_super_score</tt>. As all the input structures have a phenyl group,
    all output fields are populated. You can browse the <tt>mol_super</tt>
    column to see the best-scoring alignment that was generated.</p>

    <p>Some input structures have at least one additional aromatic ring.
    This
    calculation can be repeated with the SMARTS string <tt>a1aaaaa1</tt>. This
    uses the aromatic wildcard, <tt>a</tt>, and finds all occurrences of a
    6-membered aromatic ring. Browsing the results reveals that the phenyl/core
    alignment remains the best-scoring results.</p>
  </div>
  <div class="example">

<a id="TripQuery">
<h2>Example: Similarity Query with FlexAlign Refinement</h2>
</a>

    <ol start="1">
    <li><i>Load the template into MOE</i><br /><br />
    In the Open panel, select <tt>1ro6_ligands.mdb</tt> and press <b>OK</b>.
    Double-click on the first entry of the <tt>mol</tt> column, named
    <tt>1RO6</tt>.
      <br /><br /></li>
        <li><i>Start Molecule Superpose</i>

<p class="indent_novspace"><span class="menu">DBV | Compute | Molecule
        | Superpose...</span></p>
  </li>
  </ol>
      <p>Change <b>Query</b> to <b>Similarity</b> and change the name of the
      <b>Output</b> to <tt>mol_super</tt>.
    Press <b>Apply</b> to start the Molecular Superpose calculation while
    leaving the panel up. This calculation requires a minute or so to complete,
    and you can see status information in the MOE window (and SVL Command
    Window if open). It writes two fields to the input database:
    <tt>mol_super</tt> and <tt>mol_super_score</tt>. As <b>Similarity</b> is an
    undirected search, all entries in the output field are populated.
    </p>

    <p>The effect of FlexAlign refinement can be seen by running a second
    calculation with <span class="nobr"><b>Refine With FlexAlign</b></span>
    checked. By default, a flexible refinement is performed and formal charges
    are calculated at the start of each refinement. Change the <b>Output</b>
    field to <tt>mol_flex</tt> and press <b>OK</b> to start the calculation.
    Due to the seven refinements, a little more time is required.

    Upon completion, a new set of columns are written to the input database.
    Browsing <tt>mol_super</tt> and <tt>mol_flex</tt> shows the effect of
    FlexAlign refinement.</p>
  </div>

<a id="SeeAlso">
<h1>See Also</h1>
</a>

<p><a href="flex.htm">Flexible Alignment of Small Molecules</a>
  <a href="docking.htm">Docking</a>

  <a href="../moe/fcnref/superpos.htm">Superpose functions</a>
  <a href="../moe/fcnref/smartsfcn.htm#Description">SMARTS language
  description</a>
  <a href="../moe/extprog.htm#2DSketchers">2D Sketchers</a>
  </p>
<!-- START MOE_FOOTER -->
  <div class="MOE_FOOTER">
    <img src="../images/ccgicon.png" /> <a href="../index.htm"></a> <a href=
    "../legal.htm"></a> &copy;<span class="versionyear"></span> <a href="http://www.chemcomp.com"></a>. All
    rights reserved.
    <a href="mailto:info@chemcomp.com"></a>
  </div><!-- END MOE_FOOTER -->
</div>
</div>
</body>
</html>

