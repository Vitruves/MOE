<!DOCTYPE html>
<html>


<!--
!!    MOE On-Line Manuals
!!    COPYRIGHT (C) CHEMICAL COMPUTING GROUP ULC.  ALL RIGHTS RESERVED.
!!-->
<head>
  <meta http-equiv="x-ua-compatible" content="IE=9" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../include/manstyle.css" />
  <link rel="icon" type="image/png" href="../images/ccgicon.png" />
  <link rel="shortcut icon" type="image/png" href="../images/ccgicon.png" />
  <title>MedChem Transformations</title>
  <meta name="keywords" content="panel: MedChem Transformations" />
  <meta name="keywords" content="keywords: batch file" />
</head>
<body>
<div class="center-page">
  <!-- START MOE_HEADER -->
  <div class="MOE_HEADER">
    <a href="../index.htm"><img src="../images/ccglogo.png" /></a>
    <a href="../index.htm"><div class="moeversion"></div></a>
    MedChem Transformations
  </div>
<!-- END MOE_HEADER -->
<div class="content">
  <ul>
    <li><a href="#Method">Methodology</a></li>
    <li><a href="#CreateTrans">Creating Transformations</a></li>
    <li><a href="#RunShaman">Running MedChem Transformations</a></li>
    <li><a href="#Example" class="example">Examples</a></li>
    <ul>
    <li><a href="#oneIter" class="example">Single Iteration</a></li>
    <li><a href="#twoIter" class="example">Two Iterations/Subset</a></li>
    </ul>
    <li><a href="#Ref">References</a></li>
    <li><a href="#seeAlso">See Also</a></li>
  </ul>

<p>MedChem Transformations is an approach used to discover novel chemical
  structures by applying a set of transformation rules to existing ligands.
  Typical transformations might exchange functional groups, or alter all or
  part of individual rings while preserving the rest of ligand. These can be
  applied iteratively, resulting in cumulative changes to the starting
  structures. If a receptor is available, Forcefield Refinement can be used to
  generate bound poses along with various docking scores.</p>

<p>Individual transformations make small-scale modifications, allowing local
  exploration of chemical space surrounding the input structure(s):</p>

<img src="shaman/transpix1.jpg" alt=
  "MedChem Transformations Sample" class="center" />

<p>In this example, the central piperidine ring is changed into a pyrrolidine
  ring, preserving the N-X exit vector and the spiro center. As can be seen,
  the geometries of the two structures are similar. The user can restrict
  transformations to specific regions of the ligand, and can specify QuaSAR
  Descriptor, Model file and/or pharmacophore query filters to limit the
  results. MedChem Transformations can be used as part of a ligand-based or
  structure-based discovery methodology.
  <!-- ============================= METHODOLOGY -=========================== --></p>
<a id="Method"></a>
<h1>Methodology</h1>

<p>This application applies a set of transformations to input structures, and
  evaluates the results against a number of criteria. This flowchart describes
  the process, and each step is described below:</p>

<img src="shaman/shflow.jpg" alt=
  "MedChem Transformations Flowchart" class="center" />

<p>This can be done iteratively, increasing the number and diversity of the
  output structures. The starting point for MedChem Transformations is one or
  more superimposed ligands. If a receptor is present, the ligands are assumed
  to be in the cleft and the pocket atoms are used to constrain the
  transformations. In such cases, Forcefield Refinement and Scoring can be used
  to evaluate protein/ligand poses. Transformations can be localized by
  selecting a subset of the ligand's atoms, and the scope of the
  transformations can be controlled by setting the number of iterations to
  use.</p>

<h2>Apply Transformations</h2>

<p>Following Stewart's work with Drug Guru [Stewart&nbsp;2006], the set
  of transformations attempts to encode the medicinal chemistry expertise of a
  project team to assist them in developing SAR. Two kinds of transformations
  are present: those that preserve properties (such as switching bioisosteres)
  and those that modify properties (such as ring substitution or homologation).
  Care is taken to preserve substituent geometry wherever possible, and
  distinctions are made between chain and ring transformations as
  appropriate.</p>

<p>Transformation rules are applied via a <i>match and replace</i>
  algorithm:</p>
  <ol start="1">
    <li>A substructure search is performed to match the <i>query</i> (left-hand
    side) of each transformation rule to the input ligand(s). Every match that
    results is processed in turn.</li>
    <li>The matched atoms are replaced by those of the <i>result</i>
    (right-hand side). The details of individual transformation rules indicate
    whether query atoms or bonds are copied rather than replaced.</li>
    <li>The remaining ligand atoms (unspecified in the transformation) are
    reconnected appropriately. Transformations that result in disconnected
    heavy-atoms are discarded. Duplicates are removed once 3D coordinates have
    been generated (below).</li>
  </ol>

<p>The following example demonstrates this process:</p>

<img src="shaman/transsample1.png" alt=
  "MedChem Transformations Sample Transformation" class="center" />

<p>The reaction numbers, 1-8, indicate which atoms of the query correspond to
  those of the result. As all atoms on the left-hand side are numbered, no
  atoms will be deleted. The query contains a wildcard (<b>A</b>, meaning any
  heavy atom), and one of the carbons (<b>C(s2)</b>) must be connected to only
  two heavy-atom neighbors. When the substructure search is performed, the
  methyl substituent on the central ring blocks one of the four possible
  mappings. The valid matches for this carbon are indicated by <b>A</b>,
  <b>B</b> and <b>C</b>, and the resulting structures are given below:</p>

<img src="shaman/rxnprod1.png" alt=
  "MedChem Transformations Sample Results" class="center" />

<p>As you can see, the atoms and bonds that are not specified in the
  transformation are copied to the resulting structure. If multiple iterations
  were being performed, the new structures would be part of the input for the
  next iteration.</p>

<h2>Generate Coordinates</h2>

<p>Applying a transformation rule to a ligand updates the connectivity but
  generally results in poor geometries. This is particularly true if larger
  numbers of atoms are involved or atom insertion/deletion occurs. MedChem
  Transformations generates 3D coordinates for output molecules in two ways,
  <i>minimization or 3D embedding</i>, based on the number of atoms involved.
  Partial charges are ignored for these calculations, as MedChem
  Transformations assumes that final geometries will be created during the
  <b>Refine + Score</b> step. Ligand atoms not involved in the transformation,
  and the receptor (if present) are considered <i>invariant atoms</i>.</p>

<p>The first method is used when the bonding topology does not change or when
  there is a single connection between the new and invariant portions of the
  molecule:</p>
  <ol start="1">
    <li>If a heavy-atom was added or deleted, a short minimization using an
    elevated gradient cutoff is performed. The receptor is ignored and the
    invariant atoms are fixed for this calculation. Structures containing
    stereo centers with incorrect geometry are discarded.</li>
    <li>A second minimization is performed, with the receptor (if present)
    fixed and the invariant atoms tethered. If the heavy-atom count is
    unchanged, the stereo center check is performed and improper structures
    discarded.</li>
    <li>Structures with bond lengths or angles that fall outside the normal
    range are discarded.</li>
    <li>If more than one atom has been added, a <a href=
    "frag_combi.htm#TorsDriver">Torsion Driver</a> is used to generate the
    lowest-energy rotamer.</li>
  </ol>

<p>For more complex transformations, a multi-step 3D embedding process
  similar to <a href="../apps/confgui.htm#Methodology">Conformation Import</a>
  is used:</p>
  <ol start="1">
    <li>Construct the upper and lower distance bounds matrices (<b>U</b>,
    <b>L</b>), where the interatomic distance, <b>D<sub>ij</sub></b>, must
    satisfy <span class="nobr"><b>L<sub>ij</sub></b> &le; <b>D<sub>ij</sub></b>
    &le; <b>U<sub>ij</sub></b>.</span> The upper and lower distance bounds for
    invariant atom pairs are set to their interatomic distance, and the
    following table provides the distance bounds (in angstroms) used for
    transformed ligand atoms:
      <center>
        <table class="titlebar">
          <tr>
            <th>Pair Relationship</th>
            <th>Lower Bound</th>
            <th>Upper Bound</th>
          </tr>
          <tr>
            <td style="text-align: center; vertical-align: middle">Bond
            (<b>d<sub>12</sub></b>)</td>
            <td style="text-align: center; vertical-align: middle">1.5</td>
            <td style="text-align: center; vertical-align: middle">1.5</td>
          </tr>
          <tr>
            <td style="text-align: center; vertical-align: middle">Angle
            (<b>d<sub>13</sub></b>)</td>
            <td style="text-align: center; vertical-align: middle">2.5</td>
            <td style="text-align: center; vertical-align: middle">2.5</td>
          </tr>
          <tr>
            <td style="text-align: center; vertical-align: middle">Dihedral
            (<b>d<sub>14</sub></b>)</td>
            <td style="text-align: center; vertical-align: middle">2.8</td>
            <td style="text-align: center; vertical-align: middle">3.9</td>
          </tr>
          <tr>
            <td style="text-align: center; vertical-align: middle">
            Non-bond</td>
            <td style="text-align: center; vertical-align: middle">2.5</td>
            <td style="text-align: center; vertical-align: middle">20.0</td>
          </tr>
        </table>
      </center><br />
      The lower distance bounds for transformed atom/receptor pairs is set to
      3.0 &Aring;, a typical distance for ligand/receptor contact.
    </li>
    <li>Calculate a random interatomic distance matrix, <b>D</b>, such that
    <span class="nobr"><b>D<sub>ij</sub></b> = <b>D<sub>ji</sub></b> =
    <b>L<sub>ij</sub></b> + <b>X<sub>ij</sub></b>,</span> where
    <b>X<sub>ij</sub></b> is a random number chosen uniformly in the interval
    [0,&nbsp;<b>U<sub>ij</sub></b>&nbsp;-&nbsp;<b>L<sub>ij</sub></b>].</li>
    <li>Generate an initial set of coordinates using least-squares linear
    embedding, yielding two solutions differing by sign. If a receptor is
    present, there are sufficient invariant atoms to easily discard one of the
    solutions, as it fails to superimpose these atoms.</li>
    <li>Perform a short minimization using an elevated gradient cutoff. The
    receptor is ignored and the invariant atoms are fixed for this calculation.
    Structures containing stereo centers with incorrect geometry are
    discarded.</li>
    <li>Perform a second minimization, with the receptor (if present) fixed and
    the invariant atoms tethered. Structures with bond lengths or angles that
    fall outside normal ranges are discarded.</li>
    <li>Repeat steps (2-5) to obtain a number of ligand conformations, taking
    the lowest-energy alternative as the 3D structure.</li>
  </ol>

<p>As this process is stochastic, multiple distinct poses tend to be created.
  This, coupled with duplicate checking that preserves the lowest-energy
  structure, provides partial coverage of the ligand's conformational
  space. Hydrogen counts and partial charges are set for each generated
  structure.</p>

<p>If a receptor is present, the protein/ligand soft clash energy is
  calculated, summing the repulsive contribution for each atom pair using an
  800R3 potential:</p>

<img src="shaman/math_800R3potential.png" alt=
  "Soft Clash Potential" class="center" />

<p>where &epsilon;<sub><i>i</i></sub> and &epsilon;<sub><i>j</i></sub> are
  the van der Waals well-depths (in kcal/mol), <i>r<sub>ij</sub></i> is the
  interatomic distance and R<sub><i>i</i></sub> and R<sub><i>j</i></sub> are
  the van der Waals radii. The parameters are modified OPLS-AA van der Waals
  parameters tuned to reproduce the free energy of solvation of a collection of
  small molecules. If the lowest-energy alternative fails the clash test, it is
  discarded.</p>

<h2>Filters</h2>

<p>Constructed molecules can be filtered in three ways. First, a <a href=
  "../quasar/fcnref/descrfcn.htm#DescriptorExprSyntax">Descriptor Filter</a>
  can be specified, and the calculated MOE <a href=
  "../quasar/descr.htm">Descriptors</a> must satisfy the range/boolean values
  specified. Second, a <a href="../quasar/modcomp.htm#Composer">Model file</a>
  can be provided, and each new molecule must satisfy the specified criterion.
  Finally, a pharmacophore query can be provided, which the absolute positions
  of each new molecule must satisfy. Structures failing any of these filters
  are discarded, and all properties calculated during filtering are written to
  the output database.</p>

<h2>Synthetic Score</h2>

<p>A <a href="../moe/fcnref/rsynthfcn.htm">Synthetic Feasibility Score</a> is
  calculated for every new molecule that has passed the specified filters. This
  is a score in the range of 0 to 1 with 1 meaning fully synthesizable and 0
  meaning not feasible. MedChem Transformations can optionally discard
  structures resulting from transformations that lower the feasibility score.
  This can also be used as a term in the Descriptor Filter via the
  <tt>rsynth</tt> descriptor.</p>

<h2>Refine + Score</h2>

<p>If a receptor is present, <a href="docking.htm#Example_PostDocking">Forcefield
  Refinement</a> can be used to relax each new molecule in the pocket.
  Sidechains can be treated flexibly (with or without a tether), but backbone
  atoms are always held fixed. This generates an energy score using the
  <a href="../moe/pot.htm#Equation">Generalized Born solvation model
  (GB/VI)</a> [Labute&nbsp;2008]. This value, along with the protein
  coordinates if the sidechains were not fixed, is written to the output
  database. Molecules can be scored using one of the methods in MOE's
  <a href="docking.htm#Computational_Background">Docking</a> application. If the
  <tt>London&nbsp;dG</tt> score is calculated, the ligand efficiency (estimated
  pKi divided by the number of heavy atoms) is also written to the output
  database.</p>

<p>If no Receptor is present, tethered minimization (using the current
  forcefield) can be used to generate relaxed structures with as little global
  change in ligand alignment or orientation as possible. All atoms not involved
  with the specific transformation are considered invariant, with a force
  constant applied to each heavy atom to maintain its position. The transformed
  atoms are unconstrained, allowing the new portion of each molecule to relax
  relatively freely while preserving overall geometry.</p>

<p>If a pharmacophore query filter is used, minimization or refinement will
  use forcefield restraints between the features in the query and the
  pharmacophore annotations in the molecule. Such restraints will only be
  applied if the pharmacophore query uses the <a href="ph4_annot.htm">Unified
  Annotation Scheme</a>.
  <!-- =================== Creating Transformations ======================= !--></p>
<a id="CreateTrans"></a>
<h1>Creating Transformations</h1>

<p>Transformations are drawn as reactions using SymyxDraw, IsisDraw, ChemDraw
  or other sketchers and saved using standard file formats such as RXN
  [Symyx&nbsp;2007]. Using a 2D sketch rather than line notation such as SMIRKS
  [Daylight&nbsp;2008] makes it easier to specify and visualize
  transformations. Users can easily add or modify the rules to reflect their
  specific chemistry. Transformations must be drawn in the style
  <b>Query&nbsp;&rarr;&nbsp;Result</b> and SymyxDraw can be used to encode the
  piperidine transformation shown above:</p>

<img src="shaman/rxnpix1.png" alt=
  "MedChem Transformations Reaction Definition" class="center" />

<p>The <i>query</i> (left-hand side) defines the specific functionality to be
  transformed and the <i>result</i> (right-hand side) defines its replacement.
  The reaction (atom-pair) numbering explicitly defines the relationship
  between left- and right-hand atoms. Unnumbered atoms in the query are used
  during substructure search but otherwise discarded, while unnumbered atoms in
  the result are added to the transformed structure. Atoms and bonds not
  referenced in the reaction are preserved.</p>

<p>This reaction provides examples of both left- and right-hand side
  wildcards. For the query, <b>A</b> means any non-hydrogen atom and
  <b>C(s2)</b> means a carbon atom connected to exactly two heavy-atom
  neighbors. As this carbon is deleted by the reaction, having additional
  heavy-atom neighbors would result in a disconnected structure. For the
  result, <b>A</b> means that the matching query atom is copied from the left-
  to the right-hand side. Thus, the carbon atoms (reaction numbers 4, 5) and
  whatever atoms matched the query wildcards (reaction numbers 1-3) are copied
  to the resulting structure, preserving any connectivity that might be
  present.</p>

<p>The individual transformations, represented as individual files, can be
  collected into a single directory, or saved in a MOE database. The default
  rules used by the MedChem Transformations application are provided in
  <span class="nobr"><tt>$MOE/lib/medchem_rxn.mdb</tt></span>, in which the
  rules are stored in a field named <b>RXNData</b>. Browsing this database
  <span class="nobr">(<span class="menu">DBV | File | Browse</span>)</span>
  will reveal each rule in turn, such as the transformation used in this
  example:</p>

<img src="shaman/rxnbrowse.png" alt=
  "MedChem Transformations Reaction Browser" class="center" />

<p>Double clicking in the <b>RXNData</b> field will cause the individual
  transformations to be displayed.</p>

<p>There are several considerations when constructing or extending a
  transformation rule set:</p>
  <ul>
    <li>The set must be consistent, and an aromatization and formal charge
    policy must be set. MedChem Transformations' rules assume that
    5-membered heteroaromatic rings are drawn in Kekule notation while
    6-membered rings are drawn in either Kekule or aromatic notation. They also
    assume that any change in atomic formal charge is explicitly defined for
    the transformation.</li>
    <li>A balance must be maintained between diversity and drug-likeness.
    Halogenation or unusual functional group transformations must be used
    sparingly, so as to avoid creating non-synthesizable or otherwise
    undesirable structures. MedChem Transformations' rules tend to be
    conservative, preferring to exchange rather than add functionality.</li>
    <li>The rule set has a critical impact on performance, particularly if
    multiple iterations are used. A smaller number of generalized rules is
    preferred over a large number of specific transformations, particularly if
    the latter leads to duplicate structures that must be generated and
    discarded. To simplify rule creation, MedChem Transformations (by default)
    exchanges neutral N-, O- and S-atoms connected by single bonds to exactly
    two heavy-atom neighbors. This, for example, eliminates the need to
    duplicate rules involving pyrrole, furan, and thiophene. This can be
    disabled for individual transformations as desired.</li>
  </ul>

<p>Transformations applied to selected ligand subsets can yield unexpected
  results. In the example below, the saturated 6-membered ring is selected
  (left side). As the spiro atom is selected, transformations can be applied
  which can change the 5-membered ring:</p>

<img src="shaman/OddResult.jpg" alt="Unexpected Result" class="center" />

<p>As indicated, the 5-membered ring was transformed into a 6-membered via
  insertion of the indicated methylene. This, and the originally-selected
  6-membered ring are now candidates for additional transformations if multiple
  iterations are desired. Note that all unselected ligand atoms are maintained
  with this transformation.</p>
  <ul class="help">
    <li class="help">For an example of how to create transformations or prepare
    a custom reaction database, please refer to the <a href=
    "https://www.chemcomp.com/moe/help/2018/CCG_Tutorials/(Tutorial)_MOE_MedChem_Transformations_In-Cleft.svlx">
    MedChem Transformations Tutorial</a>.</li>
  </ul>

<h2>Maintaining Reaction Databases</h2>

<p>Reaction rules sets can be represented in two ways: a collection of files
  in a directory or as entries in a database. The latter format is more
  flexible, in that it can be annotated and rules subsets can be used when
  running MedChem Transformations. Utility functions, described below, have
  been provided to convert between formats.</p>

<h3>Database to Directory</h3>

<p>A reaction database can be converted to a directory via the following
  command entered at the <span class="nobr"><b>SVL Commands</b></span>
  prompt:</p>

<p><tt>run ['medchemtrns.svl', [database, directory, opt],
  '_MedChemTrns_MakeDir']</tt></p>

<p>where <i>database</i> is the name of an existing reaction database and
  <i>directory</i> is the name of the output directory. If the directory does
  not exist, it will be created. If the directory exists, reactions with unique
  filenames will be added. If the user specifies the option <span class=
  "nobr"><tt>overwrite:1</tt></span>, all reactions from the input database
  will be written out. All annotations will be discarded.</p>

<h3>Directory to Database</h3>

<p>A directory can be converted to a reaction database via the following
  command entered at the <span class="nobr"><b>SVL Commands</b></span>
  prompt:</p>

<p><tt>run ['medchemtrns.svl', [directory, database, opt],
  '_MedChemTrns_MakeMDB']</tt></p>

<p>where <i>directory</i> is the name of an existing directory and
  <i>database</i> is the name of the output database. If the database does not
  exist, it will be created. If the database exists, reactions with unique
  filenames will be added. If the user specifies the option <span class=
  "nobr"><tt>overwrite:1</tt></span>, all entries and fields in the output
  database will be cleared and all reactions from the input directory will be
  written out.
  <!-- ============================ RUNNING ================================ !--></p>
<a id="RunShaman"></a>
<h1>Running MedChem Transformations</h1>

<p>To start the MedChem Transformations application, load a ligand (and
  associated receptor structure if available) into the main MOE window and
  select <span class="menu">Compute | Fragments | MedChem
  Transformations...</span> to start the application:</p>

<img src="shaman/shaman_panel.png" alt="Shaman Panel" class="center" />
  <table class="noborder">
    <tr>
      <td><b>Ligand</b></td>
      <td>The atoms that define the ligand used by MedChem
      Transformations. Press the <b>?</b> button to the right to briefly
      highlight (in the MOE window) the specified atoms.</td>
    </tr>
    <tr>
      <td><b>Receptor</b></td>
      <td>The atoms that define the protein used by MedChem
      Transformations. Press the <b>?</b> button to the right to briefly
      highlight (in the MOE window) the specified atoms. This atom collection
      can also be manually specified by selecting objects in the Sequence
      Editor and choosing the appropriate atom set.</td>
    </tr>
    <tr>
      <td><b>Operation</b></td>
      <td>Specifies the method used to generate structures, using
      Scaffold Replacement, MedChem Transformations, BREED or Combinatorial
      Builder. Choose <b>MedChem Transformations</b> to run the MedChem
      Transformations application. Selecting a ligand atom subset restricts the
      calculation. The GUI reports whether it is possible to proceed: the
      number of selected atoms and molecules are indicated in green, while
      error messages are provided in red.</td>
    </tr>
    <tr>
      <td><b>Iterations</b></td>
      <td>The number of iterations to perform. All transformation
      rules are applied to the (selected) ligand atoms each iteration. The
      resulting structures are use as input to the next iteration.</td>
    </tr>
    <tr>
      <td><b>Transformations</b></td>
      <td>Specifies the name of the database (or directory)
      containing the transformation rules. These rules (described above) are
      applied to the starting molecules with each iteration. Transformation
      databases are specified by pressing <b>Browse...</b> and selecting the
      appropriate file. Clicking on <b>Open...</b> opens the transformation
      database in the Database Viewer.</td>
    </tr>
    <tr>
      <td><b>Selected Transformations Only</b></td>
      <td>If on, and the transformation database is open in the
      Database Viewer, only the selected entries will be used during the
      search.</td>
    </tr>
    <tr>
      <td><b>Configure...</b></td>
      <td>
        This button brings up a sub-panel, allowing the user to change some of
        the more technical parameters for MedChem Transformations: <img src=
        "shaman/shaman_settings.png" alt="Settings Panel" class="center" />
        <table class="noborder">
          <tr>
            <td><b>R-group Atom Tether</b></td>
            <td>If specified, a fixed-value tether is applied to
            each invariant atom during minimization.</td>
          </tr>
          <tr>
            <td><b>Transformation Limit</b></td>
            <td>Specifies the maximum number of structures that
            will be written to the output database.</td>
          </tr>
          <tr>
            <td><b>Embedding Tries</b></td>
            <td>Specifies the number of 3D embedding calculations
            to perform when generating initial coordinates.</td>
          </tr>
          <tr>
            <td><b>Protein-Ligand Clash Energy</b></td>
            <td>Specifies the protein-ligand soft clash energy
            threshold (in <span class="nobr">kcal/mol/ligand</span> atom).
            Increasing this value allows more structures to survive coordinate
            generation, which might be useful when sidechain flexibility is
            selected during protein-ligand refinement. All atoms in the
            transformed ligand are used in this calculation.</td>
          </tr>
          <tr>
            <td><b>Clash Grid Energy Threshold</b></td>
            <td>The maximum soft clash energy (in kcal) used by
            the Torsion Driver when determining accessible regions of
            space.</td>
          </tr>
          <tr>
            <td><b>Torsion Driver Stepsize</b></td>
            <td>The stepsize (in degrees) used by the Torsion
            Driver when generating rotamers of individual bonds.</td>
          </tr>
          <tr>
            <td><b>Rotamer Energy Threshold</b></td>
            <td>The energy threshold (in kcal) used by the Torsion
            Driver when discarding higher-energy rotamers. This is calculated
            using the current forcefield.</td>
          </tr>
          <tr>
            <td><b>Rotamer Duplicate Window</b></td>
            <td>The threshold (in degrees) used by the Torsion
            Driver when determining duplicate rotamers. The lowest-energy
            structure within the duplicate window is used.</td>
          </tr>
          <tr>
            <td><b>Maintain rsynth</b></td>
            <td>If on, any structure created past the first
            iteration that results in a decrease in the synthetic feasibility
            score, rsynth, will be discarded.</td>
          </tr>
          <tr>
            <td><b>Update receptor</b></td>
            <td>If on and Forcefield Refinement includes flexible
            sidechains, the receptor coordinates will be updated with
            successive iterations. Thus, refined structures from the first
            iteration will be used as the starting structure for the second
            iteration.</td>
          </tr>
	  <tr>
	    <td><b>Generate 2D</b></td>
	    <td>If on, Medchem Transformations will operate in 2D, generating
	    ligand structures without 3D embedding and independently of a
	    receptor or pocket.  3D property calculation and/or pharmacophore
	    filters are incompatible with this mode.</td>
	  </tr>
	  <tr>
	    <td><b>Depict</b></td>
	    <td>If on, aligned 2D depictions will be created for each
	    output structure.  Enabling <b>Depict</b> also enables
	    <span class="nobr"><b>Generate 2D</b></span>.</td>
	  </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td><b>Descriptor Filter</b></td>
      <td>
        If specified, this defines the criteria that generated molecules must
        satisfy. Molecules whose properties fall outside the specified range(s)
        will be omitted. Any MOE QuaSAR descriptor can be specified, and the
        condition to be satisfied can be a range of values, a boolean value,
        numeric comparisons, etc. evaluated on descriptors or SMARTS patterns.
        Descriptor Filters can include files, specified as
        <tt>@<i>filename</i></tt>. If the filename contains spaces or other
        non-alphanumeric characters, it must be enclosed in double quotes.
        Files can be nested. The current Filter can be written to a file by
        pressing <b>Save...</b> and providing a filename. Examples include:
        <table class="titlebar">
          <tr>
            <th>Expression</th>
            <th>Meaning</th>
          </tr>
          <tr>
            <td><tt>Weight[100,500] SlogP&lt;5</tt></td>
            <td>Molecular weight &ge; 100 and &le; 500 and SlogP &lt; 5</td>
          </tr>
          <tr>
            <td><tt>!reactive 'b_1rotN'&lt;4</tt></td>
            <td>Not reactive and less than 4 rotatable single bonds<br />
            (<b>Note:</b> Descriptor codes containing digits must be
            quoted.)</td>
          </tr>
          <tr>
            <td><tt>&quot;[NX3](=[OX1])[OX1]&quot;&lt;=2 not
            &quot;[#M]&quot;</tt></td>
            <td>Two or fewer nitro/nitrate groups and not metal atom</td>
          </tr>
          <tr>
            <td><tt>@filter.txt TPSA&gt;80</tt></td>
            <td>Use the contents of <tt>filter.txt</tt> and TPSA &gt; 80</td>
          </tr>
        </table><br />
        If a Descriptor Filter is specified, the color of the <b>Check
        Filters</b> button indicates whether the input ligand(s) pass (black)
        or fail (red). Clicking the button displays a text box with the
        Descriptor values for each ligand and whether they pass the Model or
        Pharmacophore filters. If there is a single ligand, its information is
        displayed in the MOE window.
      </td>
    </tr>
    <tr>
      <td><b>Model file</b></td>
      <td>Output molecules may optionally be filtered with a QSAR
      <tt>.fit</tt> file, a Model Composer <tt>.mom</tt> file, a Fingerprint
      Model <tt>.fpt</tt> file or a Pharmacophore Query <tt>.ph4</tt> file.
      Specify the name of an existing file, or click on <b>Browse...</b> to
      select a file. Generated molecules that fail to satisfy the given
      threshold condition (specified in the fields below) will be omitted.</td>
    </tr>
    <tr>
      <td><b>Pharmacophore</b></td>
      <td>If specified, the pharmacophore query to be used as a
      filter. Specify the name of an existing file or open the <a href=
      "../apps/ph4_query.htm">Pharmacophore Query Editor</a> by pressing
      <b>Editor...</b> to create or edit a query. Molecules whose absolute
      coordinates fail to satisfy the pharmacophore filter will be
      omitted.</td>
    </tr>
    <tr>
      <td><b>Output Database</b></td>
      <td>The Output Database contains the structures created by
      MedChem Transformations, along with various calculated properties. If
      <b>Open Database Viewer</b> is on then a molecular Database Viewer will
      be opened with the output database. If <b>Minimize generated
      structures</b> is on and a Receptor is present, <b>Forcefield
      Refinement</b> will be used. Use the <b>Configure...</b> button to modify
      the parameters, or to enable sidechain flexibility.<br />
      <br />
      If no Receptor is present, tethered minimization (using the current
      forcefield) will be used to generate relaxed structures with as little
      global change in R-group geometry as possible. If a Pharmacophore Filter
      is present, its features will be used as constraints in both refinement
      and minimization.</td>
    </tr>
    <tr>
      <td><b>Scoring</b></td>
      <td>Specifies which <a href=
      "../apps/docking.htm#Computational_Background">scoring methodology</a>
      to use for ranking the structures created by MedChem Transformations. Use
      the <b>Configure...</b> button to the right to configure the parameters of
      the selected method (if appropriate).</td>
    </tr>
    <tr>
      <td><b>Isolate</b></td>
      <td>Press the <b>Isolate</b> button to render the molecular
      system near the Ligand atom set and hide the remaining atoms of the
      system.</td>
    </tr>
    <tr>
      <td><b>Batch</b></td>
      <td>Opens the
       <a href="../moe/hpc.htm#BatchPanel">Batch</a> job submit
       panel, which allows the user to create
       a batch job that can be run locally outside of MOE,
       or on a compute cluster via a queueing system such as slurm:

      <img src="shaman/batchpanel.png" alt="Batch Panel" class="center" />

      The default job directory name will reflect the output database.</td>
    </tr>
    <tr>
      <td><b>Load</b></td>
      <td>Pressing the <b>Load</b> button allows the user to open a batch
      job directory and load its information:

      <img src="shaman/loadbatch.png" alt="Load Batch" class="center" />

      This loads the starting structure in into the MOE system, resets
      the selection (if specified) and restores the panel settings.</td>
    </tr>
    <tr>
      <td><b>Close</b></td>
      <td>Press the <b>Close</b> button to exit the MedChem
      Transformations application. This does not terminate the current
      search.</td>
    </tr>
  </table>

<p>After filling in the appropriate fields, press <b>Search</b> to start the
  calculation. Progress information is provided in the SVL Commands window,
  along with the bottom of the panel (if open). Pressing <b>Stop Search</b>
  while the calculation is running terminates the search. If the MedChem
  Transformations application has been closed, the current search can be
  terminated via <span class="menu">MOE | Cancel</span>, by selecting
  <b>MedChem Transformations Search</b>.</p>

<p>Upon completion, the output database will contain the following
  fields:</p>
  <table class="titlebar">
      <tr>
        <th>field</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><b>outmol</b></td>
        <td>A molecule field containing the structures generated
        by MedChem Transformations.</td>
      </tr>
      <tr>
        <td><b>rule</b></td>
        <td>The transformation rule used to create the output
        structure. When multiple iterations are used, this contains all of the
        rules that led to that structure. Double clicking on this field will
        show the transformation involved.</td>
      </tr>
      <tr>
        <td><b>inmol</b></td>
        <td>A molecule field containing the initial structure for
        the current iteration. This is an input structure for the first
        iteration, otherwise a transformed structure from an earlier
        iteration.</td>
      </tr>
      <tr>
        <td><b>mseq</b></td>
        <td>The molecular sequence number, starting at 1 and
        incrementing with every new molecule.</td>
      </tr>
      <tr>
        <td><b># trans</b></td>
        <td>The number of transformations required to create the
        current structure from an input molecule.</td>
      </tr>
      <tr>
        <td><b>RMSD</b></td>
        <td>The RMS deviation of the invariant heavy atoms after
        coordinate generation.</td>
      </tr>
      <tr>
        <td><b>Rrmsd</b></td>
        <td>The RMS deviation of the invariant heavy atoms before
        and after minimization (if performed).</td>
      </tr>
      <tr>
        <td><b>PH4 RMSD</b></td>
        <td>The RMS deviation of the fit of the output molecule to
        the pharmacophore filter (if present).</td>
      </tr>
      <tr>
        <td><b>rsynth</b></td>
        <td>The synthetic feasibility score, which is the fraction
        of the atoms of each new structure that ultimately appear in a
        retrosynthetic fragment found in the starting materials database. A
        value of one indicates that the molecule is very likely
        synthesizable.</td>
      </tr>
      <tr>
        <td><b>MM/GBVI</b></td>
        <td>If <b>Forcefield Refinement</b> is performed, this is
        a measure of the non-bonded interaction between the receptor and
        ligand. It is the sum of van der Waals, Coulomb and generalized Born
        implicit solvation interaction energies. If <b>Use GB/VI</b> is
        unselected, the protein/ligand energy using the current forcefield is
        reported as <b>E_refine</b>.</td>
      </tr>
      <tr>
        <td><b>receptor</b></td>
        <td>If <b>Forcefield Refinement</b> is performed with
        sidechain flexibility, this is a molecule field with the revised
        coordinates of the receptor.</td>
      </tr>
      <tr>
        <td><b><i>score</i></b></td>
        <td>If Scoring is used, this field contains the specific
        score value <b>ASE</b>, <b>Affinity dG</b>, <b>Alpha HB</b>,
        <b>GBVI/WSA dG</b> or <b>London dG</b>. If <b>London dG</b> scoring is
        used, the <b>Ligand Efficiency</b> is calculated for each output
        structure as well.</td>
      </tr>
    </table>

<p>If Descriptor or Model filtering is used, additional columns are created
  in the output database to receive the various calculated properties. This
  database can be analyzed using any of the other analysis tools in MOE.
  <!-- =============================== EXAMPLE ============================= --></p>
<a id="Example"></a>
<h1>Examples</h1>

<p>In this section we will present a number of example calculation using the
  MedChem Transformations application, using the PDB structure 1IOE.</p>
  <div class="example">

<h2>Prepare Input</h2>
    <ol start="1">
      <li>

<p><i>Prepare the protein/ligand pair.</i></p>
<p>First, clear the system:</p>
<p class="indent_novspace"><span class="menu">MOE | File |
        Close</span></p>
<p>Open the PDB file:</p>
<p class="indent_novspace">
  <span class="menu">MOE | File | Open</span>
</p>

<p>In the Open panel, select
  <span class= "nobr"><tt>$MOE/sample/mol/1ioe.pdb</tt></span>.
</p>

<p>Setup the forcefield and assign partial charges:</p>
<p class="indent_novspace">
  <span class="menu">MOE | Footer | Potential Setup</span>
</p>

<p>If the currently loaded forcefield is not <b>Amber10:EHT</b>,
  select it from the <b>Load</b> menu. The change is effected
  immediately. Additionally, set the solvation model to <b>R-field</b>
  and click on <b>Apply</b> to commit the change. To assign charges to
  both the protein and the ligand, click on:</p>
<p class="indent_novspace">
  <span class="menu">Potential Setup | Fix Charges</span>
</p>

<p>Press <b>Close</b> to close the Potential Setup panel.</p>
<p>Set the optimal protonation state:</p>
<p class="indent_novspace">
  <span class="menu">MOE | Compute | Prepare | Protonate 3D</span>
</p>

<p>Take the default options and press <b>OK</b>.
  This will take a minute or so to complete.</p>

<p>Hide the Receptor, ribbons and hydrogen atoms:</p>

<p class="indent_novspace">
  <span class="menu">RHS | Hide | Receptor</span>
</p>
<p class="indent_novspace">
  <span class="menu">MOE | Footer | Ribbon | Style |
    <img src="shaman/icon_noribbon.png" alt="ribbon style" class="icon" />
  </span>
</p>
<p class="indent_novspace">
  <span class="menu">RHS | Hydrogens</span>
</p>

<p>Save it to disk:</p>
<p class="indent_novspace">
  <span class="menu">MOE | File |Save</span>
</p>
<p>In the Save panel, enter
  <span class="nobr"><tt>MCTtest.moe</tt></span>.
  This can be used when rerunning the sample calculations.</p>
      </li>
      <li>
        <p><i>Start MedChem Transformations.</i></p>

<p class="indent_novspace">
  <span class="menu">MOE | Compute | Fragments | MedChem Transformations...</span>
</p>
<p>Ensure that the Receptor set is
  set to Receptor Atoms and the Ligand set is set to Ligand Atoms. Toggle
  on <span class="nobr"><b>Open Database Viewer</b></span> and
  <span class="nobr"><b>Minimize generated structures</b></span> to
  refine each output structure in the pocket. Following are two examples
  of how the remaining steps may be carried out: as a single iteration,
  or over two iterations.</p>

      </li>
    </ol>
  </div>

  <div class="example">

<a id="oneIter"></a>
<h2>Single Iteration</h2>
<p><i>Set the filtering criteria.</i></p>

<p>Change the <b>Descriptor Filter</b> to <tt>Weight&lt;560 TPSA[40,140]
    !reactive</tt>. This increases the maximum molecule weight that will be
    accepted.</p>

<p>Press <b>Search</b> to start the MedChem Transformations calculation.
    This takes a few minutes, and the progress is reported at the bottom of the
    GUI. The output molecules have molecular weights less than 560, TPSA in the
    range of 40 to 140, and should contain no reactive groups. The <span class=
    "nobr"><b>SVL Commands</b></span> window provides information about the
    calculation.</p>
  </div>

  <div class="example">
    <div class="floatright"><img src="shaman/shaman_selected.jpg" alt=
    "Two Iteration/Subset Atom Selection"/><br />
    <img src="shaman/shaman_results.jpg" alt=
    "Two Iteration/Subset Results" /></div>

<a id="twoIter"></a>
<h2>Two Iterations/Subset</h2>
    <ol start="1">
      <li>
        <p><i>Set the filtering criteria.</i></p>
        <p>Change the <b>Descriptor Filter</b> to <tt>Weight&lt;560 TPSA[40,140]
        !reactive</tt>. This increases the maximum molecule weight that will be
        accepted.</p>
    </li>
    <li>
      <p><i>Set up the calculation.</i></p>
      <p>Select the atoms of the pyridine ring (shown at right). This limits
      transformations to these atoms, their associated hydrogens and all atoms
      added by transformation. Change <b>Iterations</b> from 1 to 2.</p>
    </li>
  </ol>

<p>Press <b>Search</b> to start the MedChem Transformations calculation.
    This takes a few minutes, and the progress is reported at the bottom of the
    GUI. The <span class="nobr"><b>SVL Commands</b></span> window provides
    information about the calculation.</p>

<p>You can examine the output, <tt>medchem.mdb</tt> in the Database Viewer.
    There are roughly fifteen structures, four of which reflect a single
    transformation while the rest resulted from two transformations. The output
    molecules have molecular weights less than 560, TPSA in the range of 40 to
    140 and should not contain reactive groups. Because filtering was used,
    entries for <b>Weight</b>, <b>TPSA</b> and <b>reactive</b> were included in
    the output database.</p>

<p>You can expand the <b>rule</b> column to see the rule(s) used to create
    the structures. As you can see, <b>Rrmsd</b> is quite small for these
    structures and the results superimpose well on the starting ligand. This is
    shown to the right, with the input structure in green. All of the
    transformations involved the selected atoms or those added in the first
    iteration.</p>
  </div>
  <!-- ============================= REFERENCES ============================ -->

<a id="Ref"></a>
<h1>References</h1>
  <table class="ref">
    <tr>
      <td>[Daylight&nbsp;2008]</td>
      <td>Daylight Theory Manual, Chapter 5; Daylight Version 4.9;
      Release Date 02/01/08; Daylight Chemical Information Systems, Inc.</td>
    </tr>
    <tr>
      <td>[Labute&nbsp;2008]</td>
      <td>Labute, P.; The Generalized Born/Volume Integral
      Implicit Solvent Model: Estimation of the Free Energy of Hydration Using
      London Dispersion Instead of Atomic Surface Area; <i>J. Comput. Chem.
      29</i> (<b>2008</b>) 1693&ndash;1698.</td>
    </tr>
    <tr>
      <td>[Stewart&nbsp;2006]</td>
      <td>Stewart, K. D., Shiroda, M. and James, C. A.; Drug Guru:
      A Computer Software Program for Drug Design using Medicinal Chemistry
      Rules; <i>Bioorganic Med. Chem.</i> (<b>2006</b>) 7011&ndash;7022.</td>
    </tr>
    <tr>
      <td>[Symyx&nbsp;2007]</td>
      <td>CTFile Formats, Chapter 7: Rxnfiles; Document Date
      November 2007; Symyx Technologies, Inc.</td>
    </tr>
  </table>

<a id="seeAlso"></a>
<h1>See Also</h1>
<p><a href=
  "https://www.chemcomp.com/moe/help/2018/CCG_Tutorials/(Tutorial)_MOE_MedChem_Transformations_In-Cleft.svlx">
  MedChem Transformations Tutorial</a>.</p>

<p><a href="../quasar/fcnref/descrfcn.htm">QuaSAR-Descriptor
  Functions</a><br />
  <a href="../quasar/descr.htm">QuaSAR-Descriptor</a><br />
  <a href="ph4_guide.htm">Introduction to Pharmacophores in MOE</a><br />
  <a href="../moe/hpc.htm">High-Performance Computing Framework</a></p>

  <!-- START MOE_FOOTER -->
  <div class="MOE_FOOTER">
    <img src="../images/ccgicon.png" /> <a href="../index.htm"></a> <a href=
    "../legal.htm"></a> &copy;<span class="versionyear"></span> <a href="http://www.chemcomp.com"></a>. All
    rights reserved.<br />
    <a href="mailto:info@chemcomp.com"></a>
  </div><!-- END MOE_FOOTER -->
</div>
</div>
</body>
</html>

