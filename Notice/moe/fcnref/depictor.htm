<!DOCTYPE html>
<html>

<!--
!!    MOE On-Line Manuals
!!    COPYRIGHT (C) CHEMICAL COMPUTING GROUP ULC.  ALL RIGHTS RESERVED.
!!-->
<head>
  <meta http-equiv="x-ua-compatible" content="IE=9" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../../include/manstyle.css" />
  <link rel="icon" type="image/png" href="../../images/ccgicon.png" />
  <link rel="shortcut icon" type="image/png" href="../../images/ccgicon.png" />
  <meta name="keywords" content="keywords:" />
  <meta name="keywords" content="functions:" />
  <meta name="keywords" content=
  "functions: DepictionCoordinates, DepictionCoordinatesCTAB" />
  <meta name="keywords" content="functions: Flatten3DStructure" />
  <meta name="keywords" content=
  "functions: Draw2DStructure, Draw2DStructureCTAB" />
  <title>2D Structure Depiction</title>
</head>
<body>
<div class="center-page">
  <!-- START MOE_HEADER -->
  <div class="MOE_HEADER">
    <a href="../../index.htm"><img src="../../images/ccglogo.png" /></a>
    <a href="../../index.htm"><div class="moeversion"></div></a>
    2D Structure Depiction
  </div>
<!-- END MOE_HEADER -->
<div class="content">

<h1>Syntax</h1>

<pre>
[x, y, z] = <a class="fcnlink" href=
"#DepictionCoordinates">DepictionCoordinates</a> [mol, explicit]
[x, y, z] = <a class="fcnlink" href=
"#DepictionCoordinatesCTAB">DepictionCoordinatesCTAB</a> [ctab, explicit]
[x, y, z] = <a class="fcnlink" href=
"#Flatten3DStructure">Flatten3DStructure</a> [mol, weight]
[grkey, xform] = <a class="fcnlink" href=
"#Draw2DStructure">Draw2DStructure</a> [mol, opt]
[grkey, xform] = <a class="fcnlink" href=
"#Draw2DStructureCTAB">Draw2DStructureCTAB</a> [ctab, opt]
</pre>

<h1>Description</h1>

<p>The <tt>DepictionCoordinates</tt> function is capable of generating 2D
  coordinates for chemical structures. The results are generally suitable for
  publication-quality diagrammatic molecule representations. The layout is
  performed without use of pre-existing coordinates, and only a specification
  of the molecular connection table is required [Clark 2006].</p>

<p><tt>Draw2DStructure</tt> is used to render chemical structures with
  coordinates that have been suitably arranged in two dimensions, such as by
  the above function.</p>
<a id="DepictionCoordinatesCTAB"></a>
<a id="DepictionCoordinates"></a>
<hr noshade="noshade" />

<pre>
[x, y, z] = <span class="fcndef">DepictionCoordinates</span> [mol, explicit]
[x, y, z] = <span class=
"fcndef">DepictionCoordinatesCTAB</span> [ctab, explicit]
</pre>

<p>The following arguments are accepted:</p>
  <div class="indent">
    <dl>
      <dd></dd>
      <dt><tt>mol</tt></dt>
      <dd>
        A MOE MDB-format representation of the molecular system (see
        <tt>mol_Extract</tt>). Although the input format includes atom
        positions, they are not used by this function and have no influence on
        the depiction layout.

<p>OR:</p>
      </dd>
      <dt><tt>ctab</tt></dt>
      <dd>A CTAB representation of a molecule (see <tt>ctab_Extract</tt>).</dd>
      <dt><tt>explicit</tt></dt>
      <dd>The layout coordinates are generated by satisfying a number of
      constraints imposed only upon atoms which are marked as being explicit.
      After the primary layout is complete, atoms which are not explicit are
      added to the remaining interstitial gaps as an afterthought. By default,
      heavy atoms are considered to be explicit and hydrogens are not, with a
      few exceptions, such as dihydrogen, or hydrogen atoms attached to chiral
      ring bridge junctions. The <tt>explicit</tt> mask can be provided in
      order to override the selection.</dd>
    </dl>
  </div>

<p>The function returns the coordinate mapping produced by the
  calculation:</p>
  <div class="indent">
    <dl>
      <dd></dd>
      <dt><tt>[x, y, z]</tt></dt>
      <dd>
        2D coordinates of the molecule. Both <tt>x</tt> and <tt>y</tt> are flat
        numeric vectors which map directly to the atoms of the input structure.

<p>Note that the Z coordinate is also returned, which is generally an
        array of zeros. Under some unusual circumstances, the depiction
        algorithm returns 3D coordinates for certain parts of the molecule,
        such as for cage ring structures which were embedded in 3D. The third
        dimension is used as a hint to subsequent drawing codes. If the results
        from the depiction layout algorithm are required to be strictly planar,
        the <tt>z</tt> value should be explicitly cleared, using the syntax
        <span class="nobr"><tt>z = zero z</tt></span>.</p>
      </dd>
    </dl>
  </div>

<p>Example:</p>

<pre>
    [x, y, z] = DepictionCoordinates [mol_Extract Chains[]];
    [x, y, z] = DepictionCoordinatesCTAB [ctab_Extract [Atoms[]]];
</pre>
<a id="Flatten3DStructure"></a>
<hr noshade="noshade" />

<pre>
[x, y, z] = <span class="fcndef">Flatten3DStructure</span> [mol, weight]
</pre>

<p>The <tt>Flatten3DStructure</tt> function performs a variation of the 2D
  depiction layout process for a molecule, with additional constraints
  formulated in order to produce a result which is as similar as possible to
  the original coordinates. The additional constraints are balanced against the
  default tendency to search for a layout which is most disperse.</p>

<p>The parameters are the same as for <tt>DepictionCoordinates</tt>, except
  that the second parameter can be used as a weighting rather than just a mask,
  as it affects the relative importance of having the atoms in question
  resemble their original positions, as defined in the first parameter,
  <tt>mol</tt>.</p>

<p>The following example produces a planar embedding for a 3D molecule, using
  a weighting of 1 for the heavy atoms, and 0 for hydrogens:</p>

<pre>
    mol = mol_Extract Atoms [];
    weight = mol(4)(MOL_ATOM_EL) &lt;&gt; 'H';
    [x, y, z] = Flatten3DStructure [mol, weight];
</pre>
<a id="Draw2DStructureCTAB"></a>
<a id="Draw2DStructure"></a>
<hr noshade="noshade" />

<pre>
[grkey, xform] = <span class="fcndef">Draw2DStructure</span> [mol, opt]
[grkey, xform] = <span class="fcndef">Draw2DStructureCTAB</span> [ctab, opt]
</pre>

<p>The chemical structure provided in the <tt>mol</tt> or <tt>ctab</tt>
  parameter is rendered into a graphical object, which is returned. The
  coordinates of the atoms in the data structure are presumed appropriate for
  2D.</p>

<p>The two versions of the function are very similar, except that the CTAB
  invocation allows more control over the way in which the diagram is drawn,
  since this input is analogous to popular sketch formats. The color options
  use the color encoding described in <a href="../../svl/fcnref/grfcn.htm">Flat
  Graphics Objects</a>.</p>

<p>Rendering can be influenced by the <tt>opt</tt> parameter, which is a
  tagged vector supporting the following fields:</p>
  <div class="indent">
    <dl>
      <dd></dd>
      <dt><tt>annotations</tt></dt>
      <dd>Annotations, given as a vector of tokens, to be drawn around the
      atoms. There must be one annotation supplied for each atom.</dd>
      <dd></dd>
      <dt><tt>annotbond</tt></dt>
      <dd>Annotations, given as a vector of tokens, to be drawn at bond
      centroids. There must be one annotation supplied for each bond.</dd>
      <dd></dd>
      <dt><tt>annotcol</tt></dt>
      <dd>Annotation text color. By default, this is the same as
      <tt>maincol</tt>.</dd>
      <dd></dd>
      <dt><tt>padding</tt></dt>
      <dd>The distance (in angstroms) to be added to each side of the molecule
      when calculating the scale and offset. Default value is 1.</dd>
      <dd></dd>
      <dt><tt>boundary</tt></dt>
      <dd>Allows a bounding box to be specified for the rendering. The
      parameter is a vector of size three: <tt>[width, height, units]</tt>,
      where <tt>units</tt> should be one of <tt>'pt'</tt> or
      <tt>'pix'</tt>. The structure will be rendered into the bounding
      box, shrinking if necessary in order to fit. If the aspect ratio of the
      structure is not the same as the box, spacing will be added to as
      necessary in order to center the structure. If a bounding box is not
      given, the extent of the returned graphic object will be dependent on the
      span of the coordinates of the input molecule.</dd>
      <dd></dd>
      <dt><tt>defscale</tt></dt>
      <dd>Mutually exclusive with <tt>boundary</tt>. After normalizing the bond
      lengths of the structure, the atom-to-graphic scaling is calculated: if a
      boundary is provided, the box will be filled; otherwise if
      <tt>defscale</tt> is provided, it is used as the number of graphic units
      per angstrom; otherwise a default value is used for
      <tt>defscale</tt>.</dd>
      <dt><tt>maxscale</tt></dt>
      <dd><tt>maxscale</tt> is useful if a boundary box was provided, as it can
      prevent small structures from expanding to fit the available space. By
      specifying <tt>boundary</tt> and <tt>maxscale</tt>, it is possible to
      produce a series of structures which have a uniform size and scale,
      except when the structure is too large to fit, in which case it will be
      shrunken.</dd>
      <dt><tt>explicit</tt></dt>
      <dd>By default, the drawing algorithm decides internally which hydrogen
      atoms should be drawn as explicit atoms, which should be subsumed into
      the label of the parent atoms, and which should not be drawn at all. This
      mask can be used to control which atoms are drawn as explicit atoms.
      Atoms which are marked as not-explicit will still be folded into the
      label of the parent atom, if appropriate.</dd>
      <dt><tt>fontsize</tt></dt>
      <dd>By default, the size of the font used to label atoms is 0.5 &Aring;,
      which, using the default scale-per-point, corresponds to many molecular
      drawing conventions. It may be overridden using this parameter.</dd>
      <dt><tt>linewidth</tt></dt>
      <dd>By default, the width of the lines for single, double and triple
      bonds is 0.03 &Aring;, which similarly corresponds to many molecular
      drawing conventions. It may be overridden using this parameter.</dd>
      <dt><tt>maincol</tt></dt>
      <dd>By default, it is assumed that the drawing is to be used on a white
      background, and all of the content is drawn in black. The primary drawing
      color can be overridden with this parameter, which will be used as the
      default color for atoms, bonds and any other annotations.</dd>
      <dt><tt>colorcode</tt></dt>
      <dd>This flag, which is off by default, allows the color for atoms to be
      automatically assigned based on the element type.</dd>
      <dt><tt>coloratoms</tt></dt>
      <dd>This parameter allows explicit atom colors to be specified. If given
      as a scalar, the color will be used for all of the atoms. Otherwise it
      must be an array of length equal to the number of atoms in the input,
      each color being used for the corresponding atom.</dd>
      <dt><tt>colorbonds</tt></dt>
      <dd>
        This flag, which is off by default, forces bonds to be colorized
        according to the following rules:
        <ul>
          <li>Bonds between two atoms of the same color are drawn using that
          color;</li>
          <li>Wedge bonds use the color of the atom from which they
          originate;</li>
          <li>Single, double or triple bonds between atoms of different colors
          are drawn in two halves, using the color of the respective parent
          atom.</li>
        </ul>
      </dd>
      <dt><tt>startid</tt></dt>
      <dd>By default, atoms will be numbered according to their index in the
      CTAB or mol. With this option, however, the specified integer will be
      added to the atom numbering of all atoms. This may be useful if several
      sketches are to be merged into a single diagram. This numbering only
      affects the ids in the returned graphical object (see below).</dd>
    </dl>
  </div>

<p>The return data consist of:</p>
  <div class="indent">
    <dl>
      <dd></dd>
      <dt><tt>grkey</tt></dt>
      <dd>
        Graphical object key, containing the rendered structure. Must be closed
        using <tt>gr_destroy</tt>. The individual primitives (i.e. lines,
        ovals, text, etc.) corresponding to atoms will have ids matching the
        atom indices in the CTAB or mol, possibly modified by the
        <tt>startid</tt> option (see above). Similarly, the ids of bond objects
        will have ids computed as
        <p class="blockquote">
          2<sup>16</sup>*id<sub>from</sub> + id<sub>to</sub>
        </p>where id<sub>from</sub> and id<sub>to</sub> are the ids of
        the atoms on either end of the bond. All other primitives will have an
        id of 0. The primitive ids may be useful to determine which atom or
        bond was clicked on in a particular application.
      </dd>
      <dd></dd>
      <dt><tt>xform</tt></dt>
      <dd>The transformation between atom coordinates in angstroms, and atom
      coordinates within the space of the drawing. <tt>xform</tt> is supplied
      as a vector of 4 numbers: <tt>[ox,oy,sw,sh]</tt>. The positions of the
      atoms within the drawing can be derived by
      <tt>(X',Y')&nbsp;=&nbsp;(X*sw+ox,&nbsp;Y*sh+oy)</tt>.</dd>
    </dl>
  </div>

<p>Example:</p>

<pre>
    mol = mol_Extract Chains[];
    [x, y, z] = DepictionCoordinates [mol];
    mol(4)(MOL_ATOM_X) = x;
    mol(4)(MOL_ATOM_Y) = y;
    mol(4)(MOL_ATOM_Z) = z;
    grkey = first Draw2DStructure [mol, []];

    ...

    gr_destroy grkey;
</pre>

<h1>Reference</h1>
  <table class="ref">
    <tr>
      <td>[Clark&nbsp;2006]</td>
      <td>Clark, A.M., Labute, P., Santavy, M.; <i>J. Chem. Inf.
      Model. 46</i> (<b>2006</b>) 1107&ndash;1123.</td>
    </tr>
  </table>

<h1>See Also</h1>

<p><a href="../../svl/fcnref/grfcn.htm">Flat Graphics Objects</a></p>

<p><a class="svl" href="extract.htm">mol_Extract</a><br />
  <a class="svl" href="ctabfcn.htm">ctab_Extract</a></p>
  <!-- START MOE_FOOTER -->
  <div class="MOE_FOOTER">
    <img src="../../images/ccgicon.png" /> <a href="../../index.htm"></a>
    <a href="../../legal.htm"></a> &copy;<span class="versionyear"></span>
    <a href="http://www.chemcomp.com"></a>. All rights reserved.<br />
    <a href="mailto:info@chemcomp.com"></a>
  </div><!-- END MOE_FOOTER -->
</div>
</div>
</body>
</html>

